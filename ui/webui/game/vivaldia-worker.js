!function(){"use strict";var e,t,k,i,n=320,h=200;(t=e=e||{})[t.VivaldiNameSpaceFound=100]="VivaldiNameSpaceFound",t[t.VivaldiaWorkerInitialized=101]="VivaldiaWorkerInitialized",t[t.RequestToScreenshot=102]="RequestToScreenshot",(i=k=k||{})[i.Static=0]="Static",i[i.Dynamic=1]="Dynamic";var a=(s.prototype.set=function(t,i){this._originalWidth=t,this._originalHeight=i,this._width=this._originalWidth*this._entity._scaleX,this._height=this._originalHeight*this._entity._scaleY,this._centerX=.5*this._width,this._centerY=.5*this._height},s.prototype.reset=function(){this._hitCount=0,this.touchingTop=!1,this.touchingLeft=!1,this.touchingRight=!1,this.touchingBottom=!1},s);function s(t,i,e){this._entity=t,this.type=k.Static,this.active=!0,this._width=0,this._height=0,this._originalWidth=0,this._originalHeight=0,this._centerX=0,this._centerY=0,this.offsetX=0,this.offsetY=0,this._hits=[],this._hitCount=0,this.tagFilter=-1,this.collisionEdgeTop=!0,this.collisionEdgeLeft=!0,this.collisionEdgeRight=!0,this.collisionEdgeBottom=!0,this.touchingTop=!1,this.touchingLeft=!1,this.touchingRight=!1,this.touchingBottom=!1,this.slope=0,this.slopeNumber=0,this.slopeOffsetTop=0,this.slopeOffsetLeft=0,this.slopeOffsetRight=0,this.slopeOffsetBottom=0,this.safeAreaTop=0,this.safeAreaLeft=0,this.safeAreaRight=0,this.safeAreaBottom=0,this.set(i,e)}function o(t){return void 0===t&&(t=new Float32Array(16)),t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function _(t,i,e,s,a,o,r){return void 0===r&&(r=new Float32Array(16)),r[0]=2/(i-t),r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=2/(s-e),r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2/(a-o),r[11]=0,r[12]=(t+i)/(t-i),r[13]=(e+s)/(e-s),r[14]=(a+o)/(a-o),r[15]=1,r}function l(t,i,e,s,a){void 0===a&&(a=new Float32Array(16));var o=t[0],r=t[1],n=t[2],h=t[3],_=t[4],l=t[5],d=t[6],c=t[7],p=t[8],u=t[9],g=t[10],f=t[11],y=t[12],m=t[13],v=t[14],x=t[15];return t!==a&&(a[0]=o,a[1]=r,a[2]=n,a[3]=h,a[4]=_,a[5]=l,a[6]=d,a[7]=c,a[8]=p,a[9]=u,a[10]=g,a[11]=f),a[12]=o*i+_*e+p*s+y,a[13]=r*i+l*e+u*s+m,a[14]=n*i+d*e+g*s+v,a[15]=h*i+c*e+f*s+x,a}function c(t,i,e,s,a){return void 0===a&&(a=new Float32Array(16)),a[0]=i*t[0],a[1]=i*t[1],a[2]=i*t[2],a[3]=i*t[3],a[4]=e*t[4],a[5]=e*t[5],a[6]=e*t[6],a[7]=e*t[7],a[8]=s*t[8],a[9]=s*t[9],a[10]=s*t[10],a[11]=s*t[11],t!==a&&(a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]),a}function r(t,i){for(var e=[],s=0;s<i.length;s++){var a=0==s?t.VERTEX_SHADER:t.FRAGMENT_SHADER,o=function(t,i,e){var s=t.createShader(e);if(!s)return console.error("failed to load shader"),null;if(t.shaderSource(s,i),t.compileShader(s),t.getShaderParameter(s,t.COMPILE_STATUS))return s;var a=t.getShaderInfoLog(s);return console.error("Shader Error '"+s+"':"+a),t.deleteShader(s),null}(t,i[s],a);o&&e.push(o)}return function(i,t){var e=i.createProgram();if(!e)return console.error("failed to create WebGL program"),null;if(t.forEach(function(t){i.attachShader(e,t)}),i.linkProgram(e),i.getProgramParameter(e,i.LINK_STATUS))return e;var s=i.getProgramInfoLog(e);return console.error("Error linking:"+s),i.deleteProgram(e),null}(t,e)}var w=(d.init=function(){this._stack=[],this._currentStackPosition=0,this._r=1,this._g=1,this._b=1,this._a=1,this._mainMatrix=new Float32Array(16),this._spriteMatrix=new Float32Array(16),this._textures={},this._stack[0]=o();var t=lt._canvas.getContext("webgl",{alpha:!0,premultipliedAlpha:!0});null!=t&&(this._gl=t),this._gl.clearColor(0,0,0,1),this._gl.enable(this._gl.BLEND),this._gl.blendFunc(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA);var i,e,s,a=r(this._gl,["\nattribute vec4 a_position;\nattribute vec2 a_texcoord;\n\nuniform mat4 u_matrix;\nuniform mat4 u_textureMatrix;\n\nvarying vec2 v_texcoord;\n\nvoid main() {\n   gl_Position = u_matrix * a_position;\n   v_texcoord = (u_textureMatrix * vec4(a_texcoord, 0, 1)).xy;\n}\n","\nprecision mediump float;\n\nvarying vec2 v_texcoord;\n\nuniform bool u_noTexture;\nuniform sampler2D texture;\nuniform vec4 u_color;\n\nvoid main() {\n    if(u_noTexture) {\n        gl_FragColor = u_color;\n    }\n    else {\n        gl_FragColor = texture2D(texture, v_texcoord) * u_color;\n    }\n}\n"]);a?(this._positionLocation=this._gl.getAttribLocation(a,"a_position"),this._texcoordLocation=this._gl.getAttribLocation(a,"a_texcoord"),this._matrixLocation=this._gl.getUniformLocation(a,"u_matrix"),this._textureMatrixLocation=this._gl.getUniformLocation(a,"u_textureMatrix"),this._textureLocation=this._gl.getUniformLocation(a,"u_texture"),this._colorLocation=this._gl.getUniformLocation(a,"u_color"),this._noTextureLocation=this._gl.getUniformLocation(a,"u_noTexture"),i=this._gl.createBuffer(),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,i),this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),this._gl.STATIC_DRAW),e=this._gl.createBuffer(),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,e),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,e),this._gl.enableVertexAttribArray(this._texcoordLocation),this._gl.vertexAttribPointer(this._texcoordLocation,2,this._gl.FLOAT,!1,0,0),this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),this._gl.STATIC_DRAW),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,i),this._gl.enableVertexAttribArray(this._positionLocation),this._gl.vertexAttribPointer(this._positionLocation,2,this._gl.FLOAT,!1,0,0),this._gl.useProgram(a),this._gl.viewport(0,0,n,h),this._gl.uniform1i(this._textureLocation,0),this._renderTexture=this._gl.createTexture(),this._gl.bindTexture(this._gl.TEXTURE_2D,this._renderTexture),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,n,h,0,this._gl.RGBA,this._gl.UNSIGNED_BYTE,null),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE),s=this._gl.createRenderbuffer(),this._gl.bindRenderbuffer(this._gl.RENDERBUFFER,s),this._gl.renderbufferStorage(this._gl.RENDERBUFFER,this._gl.DEPTH_STENCIL,n,h),this._renderFrameBuffer=this._gl.createFramebuffer(),this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,this._renderFrameBuffer),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.COLOR_ATTACHMENT0,this._gl.TEXTURE_2D,this._renderTexture,0),this._gl.framebufferRenderbuffer(this._gl.FRAMEBUFFER,this._gl.DEPTH_STENCIL_ATTACHMENT,this._gl.RENDERBUFFER,s),this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null)):console.error("failed to create shader program from sources")},d.restore=function(){this._currentStackPosition--},d.save=function(){this._currentStackPosition++,this._stack[this._currentStackPosition]=this._stack[this._currentStackPosition-1]},d._getCurrentMatrix=function(){return this._stack[this._currentStackPosition]},d._setCurrentMatrix=function(t){return this._stack[this._currentStackPosition]=t},d.translate=function(t,i,e){void 0===e&&(e=0);var s=this._getCurrentMatrix();this._setCurrentMatrix(l(s,t,i,e,this._mainMatrix))},d.rotateZ=function(t){var i=this._getCurrentMatrix();this._setCurrentMatrix(function(t,i,e){void 0===e&&(e=new Float32Array(16));var s=t[0],a=t[1],o=t[2],r=t[3],n=t[4],h=t[5],_=t[6],l=t[7],d=Math.cos(i),c=Math.sin(i);return e[0]=d*s+c*n,e[1]=d*a+c*h,e[2]=d*o+c*_,e[3]=d*r+c*l,e[4]=d*n-c*s,e[5]=d*h-c*a,e[6]=d*_-c*o,e[7]=d*l-c*r,t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e}(i,t,this._mainMatrix))},d.scale=function(t,i,e){void 0===e&&(e=1);var s=this._getCurrentMatrix();this._setCurrentMatrix(c(s,t,i,e,this._mainMatrix))},d.setDrawColor=function(t,i,e,s){this._r=t,this._g=i,this._b=e,this._a=s},d.drawRect=function(t,i,e,s){this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._gl.uniform1i(this._noTextureLocation,1),this._drawObject(t,i,e,s,!1,!1)},d.drawSprite=function(t,i,e,s,a,o,r){void 0===s&&(s=0),void 0===a&&(a=0),void 0===o&&(o=t._texture._image.width),void 0===r&&(r=t._texture._image.height);var n,h,_,l,d=c(d=(n=s/t._texture._image.width,h=a/t._texture._image.height,void(_=0)===(l=this._spriteMatrix)&&(l=new Float32Array(16)),l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=n,l[13]=h,l[14]=_,l[15]=1,l),o/t._texture._image.width,r/t._texture._image.height,1,d);this._gl.uniformMatrix4fv(this._textureMatrixLocation,!1,d),this._gl.bindTexture(this._gl.TEXTURE_2D,t._texture._webGLTexture),this._gl.uniform1i(this._noTextureLocation,0),this._drawObject(i,e,o,r,t.flipX,t.flipY)},d._drawObject=function(t,i,e,s,a,o){var r=_(0,n,h,0,-10,10,this._spriteMatrix);r=c(r=l(r=function(t,i,e){void 0===e&&(e=new Float32Array(16));var s=i[0],a=i[1],o=i[2],r=i[3],n=i[4],h=i[5],_=i[6],l=i[7],d=i[8],c=i[9],p=i[10],u=i[11],g=i[12],f=i[13],y=i[14],m=i[15],v=t[0],x=t[1],T=t[2],S=t[3],w=t[4],b=t[5],D=t[6],A=t[7],E=t[8],F=t[9],B=t[10],P=t[11],C=t[12],k=t[13],U=t[14],R=t[15];return e[0]=s*v+a*w+o*E+r*C,e[1]=s*x+a*b+o*F+r*k,e[2]=s*T+a*D+o*B+r*U,e[3]=s*S+a*A+o*P+r*R,e[4]=n*v+h*w+_*E+l*C,e[5]=n*x+h*b+_*F+l*k,e[6]=n*T+h*D+_*B+l*U,e[7]=n*S+h*A+_*P+l*R,e[8]=d*v+c*w+p*E+u*C,e[9]=d*x+c*b+p*F+u*k,e[10]=d*T+c*D+p*B+u*U,e[11]=d*S+c*A+p*P+u*R,e[12]=g*v+f*w+y*E+m*C,e[13]=g*x+f*b+y*F+m*k,e[14]=g*T+f*D+y*B+m*U,e[15]=g*S+f*A+y*P+m*R,e}(r,this._getCurrentMatrix(),r),a?-t:t,o?-i:i,0,r),a?-e:e,o?-s:s,1,r),this._gl.uniformMatrix4fv(this._matrixLocation,!1,r),this._gl.uniform4f(this._colorLocation,this._r,this._g,this._b,this._a),this._gl.drawArrays(this._gl.TRIANGLES,0,6)},d.createTexture=function(t,i){if(this._textures[t])return this._textures[t];var e=this._gl.createTexture();if(null!=e){var s=e;return this._gl.bindTexture(this._gl.TEXTURE_2D,s),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,i),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.NEAREST),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),this._textures[t]=s}},d.clear=function(){this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT)},d.setRenderToTargetTexture=function(){this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,this._renderFrameBuffer),this._gl.viewport(0,0,n,h)},d.renderTargetTextureToMainBuffer=function(){this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null),this._gl.viewport(0,0,lt._canvas.width,lt._canvas.height),this.setDrawColor(1,1,1,1),this.clear(),this._gl.uniformMatrix4fv(this._textureMatrixLocation,!1,o()),this._gl.bindTexture(this._gl.TEXTURE_2D,this._renderTexture),this._gl.uniform1i(this._noTextureLocation,0);var t=c(t=_(0,n,0,h,-10,10,this._spriteMatrix),n,h,1,t);this._gl.uniformMatrix4fv(this._matrixLocation,!1,t),this._gl.uniform4f(this._colorLocation,this._r,this._g,this._b,this._a),this._gl.drawArrays(this._gl.TRIANGLES,0,6)},d);function d(){}var p=(u.init=function(){this._images={},this._imagesTotal=0,this._imagesLoaded=0,this._loadedCallback=null},u.setOnLoadedCallback=function(t){this._loadedCallback=t},u.createImage=function(i){var e=this;this._imagesTotal++,function(t,i,e){void 0===e&&(e="");var s=new XMLHttpRequest;s.onload=function(){i(s.response)},s.onerror=function(){console.error("error trying to get url: "+t),i(null)},s.open("GET",t),s.responseType=e,s.send()}(i,function(t){createImageBitmap(t).then(function(t){e._images[i]=t,e._imagesLoaded++,e._runCallbackIfLoaded()})},"blob")},u._runCallbackIfLoaded=function(){null!=this._loadedCallback&&this._imagesTotal==this._imagesLoaded&&(this._loadedCallback(),this._loadedCallback=null)},u);function u(){}var m=function(t,i,e,s,a){void 0===i&&(i=null),void 0===e&&(e=null),void 0===s&&(s=0),void 0===a&&(a=0),this._image=p._images[t],this._drawWidth=i||this._image.width,this._drawHeight=e||this._image.height,this._drawFromX=s,this._drawFromY=a,this._halfWidth=.5*this._drawWidth,this._halfHeight=.5*this._drawHeight,this.colorTintR=1,this.colorTintG=1,this.colorTintB=1,this.colorTintA=1;var o=w.createTexture(t,this._image);if(!o)return this._webGLTexture=null,void console.error("failed to create texture");this._webGLTexture=o},g=function(t,i,e,s){void 0===e&&(e=0),void 0===s&&(s=0),this.texture=t,this.duration=i,this.addToSpriteOffsetX=e,this.addToSpriteOffsetY=s},f=(y.prototype.setTexture=function(t){this._texture=t},y.prototype.repeatAnimation=function(t){this._repeatAnimation=t,this._isAnimating=t},y.prototype.playAnimation=function(){this._currentFrame=-1,this._isAnimating=!0},y.prototype.fixedUpdate=function(){var t;this._isAnimating&&0<this._animationCount&&this._nextAnimationTime<=rt._lastUpdateTime&&(this._currentFrame++,this._currentFrame==this._animationCount&&(this.animationFinishedCallback(),this._repeatAnimation?this._currentFrame=0:(this._isAnimating=!1,this._currentFrame=-1)),this._isAnimating&&(null==(t=this._animation[this._currentFrame])?console.error("sprite animation needs to be cleared!"):(this._texture=t.texture,this._nextAnimationTime=rt._lastUpdateTime+t.duration,this.drawOffsetX+=t.addToSpriteOffsetX,this.drawOffsetY+=t.addToSpriteOffsetY))),0<this._frameCountX&&this._updateOnNextFrameNumberX<=rt._fixedUpdateCount&&(this._updateOnNextFrameNumberX=rt._fixedUpdateCount+this._updateDelayX,this._currentFrameX+=1,this._currentFrameX==this._frameCountX&&(this._animationLoopX?this.setAnimationX(this._updateDelayX,this._frameCountX):(this._currentFrameX=this._frameCountX-1,this._frameCountX=0))),0<this._frameCountY&&this._updateOnNextFrameNumberY<=rt._fixedUpdateCount&&(this._updateOnNextFrameNumberY=rt._fixedUpdateCount+this._updateDelayY,this._currentFrameY+=1,this._currentFrameY==this._frameCountY&&(this._animationLoopY?this.setAnimationY(this._updateDelayY,this._frameCountY):(this._currentFrameY=this._frameCountY-1,this._frameCountY=0)))},y.prototype.setAnimationX=function(t,i,e){void 0===e&&(e=!0),this._frameCountX=i,this._updateDelayX=t,this._currentFrameX=0,this._animationLoopX=e,this._updateOnNextFrameNumberX=rt._fixedUpdateCount+this._updateDelayX},y.prototype.setAnimationY=function(t,i,e){void 0===e&&(e=!0),this._frameCountY=i,this._updateDelayY=t,this._currentFrameY=0,this._animationLoopY=e,this._updateOnNextFrameNumberY=rt._fixedUpdateCount+this._updateDelayY},y.prototype.addAnimationFrame=function(t,i,e,s){void 0===e&&(e=0),void 0===s&&(s=0),this._animation[this._animationCount]?(this._animation[this._animationCount].texture=t,this._animation[this._animationCount].duration=i):this._animation[this._animationCount]=new g(t,i,e,s),this._animationCount++},y.prototype.clearAnimation=function(){this._animationCount=0,this._currentFrame=0},y.prototype.resetAnimationX=function(){this._currentFrameX=0,this._frameCountX=0},y.prototype.resetAnimationY=function(){this._currentFrameY=0,this._frameCountY=0},y);function y(t,i,e){void 0===i&&(i=0),void 0===e&&(e=0),this.active=!0,this._frameCountX=0,this._frameCountY=0,this._updateDelayX=0,this._updateDelayY=0,this._animationLoopX=!0,this._animationLoopY=!0,this._animation=[],this._animationCount=0,this._currentFrame=-1,this._currentFrameX=0,this._currentFrameY=0,this._updateOnNextFrameNumberX=0,this._updateOnNextFrameNumberY=0,this._texture=t,this.drawOffsetX=i,this.drawOffsetY=e,this.flipX=!1,this.flipY=!1,this._nextAnimationTime=-1,this._repeatAnimation=!0,this._isAnimating=!0,this.animationFinishedCallback=function(){}}var v=(x.prototype.fixedUpdate=function(t){var i=t._aabb.getCenterX()+this._paddingCenterX+this.startOffsetX,e=t._aabb.getWidth()+this._paddingWidthX,s=this._currentRepeatCountX*e,a=ht._x*this._parallaxSpeedX,o=t.x+t._aabb.x1-this._paddingWidthX+this.triggerOffsetX,r=t.x+t._aabb.x2+this._paddingWidthX+this.triggerOffsetX;t.x=a-i+s,ht._x>r?(t.x+=e,this._currentRepeatCountX++):ht._x<o&&(t.x-=e,this._currentRepeatCountX--)},x);function x(t,i,e){void 0===t&&(t=0),void 0===i&&(i=0),void 0===e&&(e=0),this._currentRepeatCountX=0,this.startOffsetX=0,this.triggerOffsetX=0,this._parallaxSpeedX=t,this._paddingWidthX=i+e,this._paddingCenterX=-i+e}var T=function(){this.active=!0,this.velocityX=0,this.velocityY=0,this._lastX=0,this._lastY=0,this.gravityEnabledX=!0,this.gravityEnabledY=!0},S=(b.prototype.getWidth=function(){return-this.x1+this.x2},b.prototype.getHeight=function(){return-this.y1+this.y2},b.prototype.getCenterX=function(){return this.x1+this.x2},b.prototype.getCenterY=function(){return this.y1+this.y2},b);function b(){this.x1=0,this.y1=0,this.x2=0,this.y2=0}var D=function(t,i,e,s,a,o,r,n){void 0===s&&(s=0),void 0===a&&(a=0),void 0===o&&(o=32),void 0===r&&(r=3),void 0===n&&(n=32),this._charWidth=i,this._charHalfWidth=.5*i,this._charHeight=e,this._charHalfHeight=.5*e,this._textures={};for(var h=-1,_=-1,l=0;l<96;l++){h++,l%o==0&&(_++,h=0);var d=String.fromCharCode(l+n),c=new m(t,i,e,s+h*i,a+_*e);this._textures[d]=c}},A=(E.prototype.addSprite=function(t,i,e){void 0===i&&(i=0),void 0===e&&(e=0);var s=new f(t,i,e);return this._sprites.push(s),this._spriteCount++,this.calculateAABB(),s},E.prototype.addCollider=function(t,i){var e=new a(this,t,i);this._colliders.push(e),this._colliderCount++;for(var s=0;s<10;s++)e._hits.push(new a(this,1,1));return e},E.prototype.calculateAABB=function(){for(var t=0;t<this._spriteCount;t++){var i=this._sprites[t],e=i.drawOffsetX-i._texture._halfWidth,s=i.drawOffsetY-i._texture._halfHeight,a=i.drawOffsetX+i._texture._halfWidth,o=i.drawOffsetY+i._texture._halfHeight;this._aabb.x1=0==t?e:Math.min(e,this._aabb.x1),this._aabb.y1=0==t?s:Math.min(s,this._aabb.y1),this._aabb.x2=0==t?a:Math.max(a,this._aabb.x2),this._aabb.y2=0==t?o:Math.max(o,this._aabb.y2)}},E.prototype.setActive=function(t){this._active!=t&&(this._active=t,this._currentObjectPool&&(t?this._currentObjectPool._availableCount--:this._currentObjectPool._availableCount++))},E.prototype.setText=function(t,i){var e;void 0===i&&(i=lt._defaultFont);var s=t.length*i._charWidth*-.5;this._spriteCount=t.length;for(var a=0;a<t.length;a++)this._sprites[a]?this._sprites[a]._texture=i._textures[t[a]]:this._sprites[a]=new f(i._textures[t[a]]),this._sprites[a].drawOffsetX=s+i._charHalfWidth,s+=i._charWidth;(null===(e=this._text)||void 0===e?void 0:e.length)!=t.length&&this.calculateAABB(),this._text=t},E.prototype.setScale=function(t,i){this._scaleX=t,this._scaleY=i;for(var e=0;e<this._colliderCount;e++){var s=this._colliders[e];this._colliders[e].set(s._originalWidth,s._originalHeight)}},E);function E(t,i){this._id=-1,this._active=!0,this.x=t,this.y=i,this.tag=-1,this._layer=0,this.rotation=0,this._scaleX=1,this._scaleY=1,this._sprites=[],this._spriteCount=0,this._colliders=[],this._colliderCount=0,this._text=null,this.ui=!1,this._markedForRemoval=!1,this.fixedUpdate=null,this._currentObjectPool=null,this.colorTintR=1,this.colorTintG=1,this.colorTintB=1,this.colorTintA=1,this._aabb=new S,this.parallax=null,this.rigidBody=null}var F=Math.PI/180,B=(P.init=function(){this._layerCount=12,this._allEntities=[],this._uniqueId=0,this._gravityX=0,this._gravityY=1,this._entitiesByLayers=[];for(var t=0;t<this._layerCount;t++)this._entitiesByLayers[t]=[]},P.fixedUpdate=function(){for(var t=this._allEntities.length-1;0<=t;t--){if((C=this._allEntities[t])._markedForRemoval){for(var i=0;i<this._entitiesByLayers[C._layer].length;i++)if(C._id==this._entitiesByLayers[C._layer][i]._id){this._entitiesByLayers[C._layer].splice(i,1);break}this._allEntities.splice(t,1)}if(C._active){C.rigidBody&&C.rigidBody.active&&(C.rigidBody._lastX=C.x,C.rigidBody._lastY=C.y,C.rigidBody.gravityEnabledX&&(C.rigidBody.velocityX+=this._gravityX),C.rigidBody.gravityEnabledY&&(C.rigidBody.velocityY+=this._gravityY),C.x+=C.rigidBody.velocityX,C.y+=C.rigidBody.velocityY);for(var e=0;e<C._colliders.length;e++){(u=C._colliders[e]).active&&u.reset()}}}for(t=0;t<this._allEntities.length;t++){if((C=this._allEntities[t])._active){for(var s=0;s<C._sprites.length;s++){var a=C._sprites[s];a.active&&a.fixedUpdate()}if(C.parallax&&C.parallax.fixedUpdate(C),0<C._colliderCount)for(var o=0;o<C._colliderCount;o++){if((u=C._colliders[o]).active&&u.type!=k.Static)for(i=0;i<this._allEntities.length;i++){var r=this._allEntities[i];if(!(C.ui&&!r.ui||!C.ui&&r.ui)&&(r._active&&0<r._colliderCount))for(var n,h,_,l,d=0;d<r._colliderCount;d++){(f=r._colliders[d]).active&&t!=i&&(-1!=C.tag&&C.tag==f.tagFilter||-1!=r.tag&&r.tag==u.tagFilter||(n=C.x,h=C.y,_=r.x,l=r.y,n-=u._centerX-u.offsetX,h-=u._centerY-u.offsetY,_-=f._centerX-f.offsetX,l-=f._centerY-f.offsetY,n<_+f._width&&n+u._width>_&&h<l+f._height&&h+u._height>l&&((u._hits[u._hitCount++]=f)._hits[f._hitCount++]=u)))}}}}}for(t=0;t<this._allEntities.length;t++){if((C=this._allEntities[t])._active&&C.rigidBody&&C.rigidBody.active&&0<C._colliderCount){var c=0,p=0;if(0!=C.rigidBody.velocityX||0!=C.rigidBody.velocityY)for(i=0;i<C._colliderCount;i++)for(var u=C._colliders[i],g=0;g<u._hitCount;g++){var f,y,m,v,x,T,S,w,b,D,A,E,F,B,P,r=(f=u._hits[g])._entity;0<f.slope?(0<C.rigidBody.velocityX||0<C.rigidBody.velocityY)&&(T=C.x+u._centerX+u.offsetX+u.slopeOffsetRight,A=C.y+u._centerY+u.offsetY+u.slopeOffsetBottom,D=r.x+f._centerX+f.offsetX+f.slopeOffsetRight,P=r.y+f._centerY+f.offsetY+f.slopeOffsetBottom,y=f._width+(T-D),m=f._height-(A-P),y=Math.ceil(y/Math.abs(f.slope)),(m-=Math.floor(_t._map._tileheight*f.slopeNumber/Math.abs(f.slope)))-f._height<=y&&(v=-(y-(m-f._height)),u.touchingBottom=!0,f.touchingTop=!0,D<T&&(v+=T-D),p=Math.min(p,v))):f.slope<0?(C.rigidBody.velocityX<0||0<C.rigidBody.velocityY)&&(w=C.x-u._centerX+u.offsetX-u.slopeOffsetLeft,A=C.y+u._centerY+u.offsetY-u.slopeOffsetBottom,S=r.x-f._centerX+f.offsetX-f.slopeOffsetLeft,P=r.y+f._centerY+f.offsetY-f.slopeOffsetBottom,y=f._width-(w-S),m=f._height-(A-P),y=Math.ceil(y/Math.abs(f.slope)),(m-=Math.floor(_t._map._tileheight*f.slopeNumber/Math.abs(f.slope)))-f._height<=y&&(v=-(y-(m-f._height)),u.touchingBottom=!0,f.touchingTop=!0,w<S&&(v+=S-w),p=Math.min(p,v))):(0<C.rigidBody.velocityX&&u.collisionEdgeRight&&f.collisionEdgeLeft?(x=C.rigidBody._lastX+u._centerX+u.offsetX-u.safeAreaRight,T=C.x+u._centerX+u.offsetX,x<=(S=r.x-f._centerX+f.offsetX)&&(u.touchingRight=!0,f.touchingLeft=!0,c=Math.min(c,S-T))):C.rigidBody.velocityX<0&&u.collisionEdgeLeft&&f.collisionEdgeRight&&(w=C.x-u._centerX+u.offsetX,b=C.rigidBody._lastX-u._centerX+u.offsetX+u.safeAreaLeft,(D=r.x+f._centerX+f.offsetX)<=b&&(u.touchingLeft=!0,f.touchingRight=!0,c=Math.max(c,D-w))),0<C.rigidBody.velocityY&&u.collisionEdgeBottom&&f.collisionEdgeTop?(A=C.y+u._centerY+u.offsetY,C.rigidBody._lastY+u._centerY+u.offsetY-u.safeAreaBottom<=(E=r.y-f._centerY+f.offsetY)&&(u.touchingBottom=!0,f.touchingTop=!0,p=Math.min(p,E-A))):C.rigidBody.velocityY<0&&u.collisionEdgeTop&&f.collisionEdgeBottom&&(F=C.y-u._centerY+u.offsetY,B=C.rigidBody._lastY-u._centerY+u.offsetY+u.safeAreaTop,(P=r.y+f._centerY+f.offsetY)<=B&&(u.touchingTop=!0,f.touchingBottom=!0,p=Math.max(p,P-F))))}0!=c&&(C.x+=c,C.rigidBody.velocityX=0),0!=p&&(C.y+=p,C.rigidBody.velocityY=0)}}for(var C,t=0;t<this._allEntities.length;t++){(C=this._allEntities[t])._active&&C.fixedUpdate&&C.fixedUpdate.fixedUpdate(C)}},P.draw=function(){w.setRenderToTargetTexture(),w.clear();for(var t=0;t<this._layerCount;t++)for(var i=0;i<P._entitiesByLayers[t].length;i++){if((f=P._entitiesByLayers[t][i])._active){w.save(),f.ui||(w.translate(-ht._x+nt._centerX,-ht._y+nt._centerY),w.rotateZ(ht.rotation*F)),w.translate(f.x,f.y),w.scale(f._scaleX,f._scaleY),w.rotateZ(f.rotation*F);for(var e=0;e<f._spriteCount;e++){var s,a,o,r,n,h,_,l,d,c,p,u,g=f._sprites[e];g.active&&(s=f.x+g._texture._halfWidth+g.drawOffsetX,a=f.x-g._texture._halfWidth+g.drawOffsetX,!f.ui&&!f.parallax&&(s<ht._worldLeft||a>ht._worldRight)||(o=Math.floor(-g._texture._halfWidth+g.drawOffsetX),r=Math.floor(-g._texture._halfHeight+g.drawOffsetY),n=g._texture._drawFromX+g._texture._drawWidth*g._currentFrameX,h=g._texture._drawFromY+g._texture._drawHeight*g._currentFrameY,_=f.colorTintR*g._texture.colorTintR,l=f.colorTintG*g._texture.colorTintG,d=f.colorTintB*g._texture.colorTintB,c=f.colorTintA*g._texture.colorTintA,w.setDrawColor(_,l,d,c),w.drawSprite(g,o,r,n,h,g._texture._drawWidth,g._texture._drawHeight),f.parallax&&(p=o-f._aabb.getWidth()-f.parallax._paddingWidthX,w.drawSprite(g,p,r,n,h,g._texture._drawWidth,g._texture._drawHeight),u=o+f._aabb.getWidth()+f.parallax._paddingWidthX,w.drawSprite(g,u,r,n,h,g._texture._drawWidth,g._texture._drawHeight))))}w.restore()}}if(W._isActive)for(t=0;t<this._layerCount;t++)for(var f,i=0;i<P._entitiesByLayers[t].length;i++){if((f=P._entitiesByLayers[t][i])._active){w.save(),f.ui||w.translate(-ht._x+nt._centerX,-ht._y+nt._centerY),w.translate(f.x,f.y),w.setDrawColor(1,1,1,.1),w.drawRect(f._aabb.x1,f._aabb.y1,f._aabb.getWidth(),1),w.drawRect(f._aabb.x2,f._aabb.y1,1,f._aabb.getHeight()),w.drawRect(f._aabb.x1,f._aabb.y2,f._aabb.getWidth(),1),w.drawRect(f._aabb.x1,f._aabb.y1,1,f._aabb.getHeight());for(var y=0;y<f._colliderCount;y++){var m,v,x,T,S=f._colliders[y];S.active&&(w.setDrawColor(0,1,0,.2),m=-S._centerX+S.offsetX,v=-S._centerY+S.offsetY,w.drawRect(m,v,S._width,S._height),S.collisionEdgeTop&&w.drawRect(m,v,S._width,1+S.safeAreaTop),S.collisionEdgeLeft&&w.drawRect(m,v,1+S.safeAreaLeft,S._height),S.collisionEdgeRight&&(x=S.safeAreaRight,w.drawRect(m+S._width-1-x,v,1+x,S._height)),S.collisionEdgeBottom&&(T=S.safeAreaBottom,w.drawRect(m,v+S._height-1-T,S._width,1+T)))}w.restore()}}w.renderTargetTextureToMainBuffer()},P);function P(){}var rt=(C.init=function(){this._lastUpdateTime=0,this._nextUpdateTime=0,this._lastDrawTime=0,this._fixedUpdateCount=0,this._fixedDeltaTime=1e3/60},C);function C(){}var U=(R.init=function(t,i){void 0===t&&(t=function(){}),void 0===i&&(i=function(){}),this._updateFn=t,this._drawFn=i,this._updateHz=0,this._drawHz=0,this._updatePerformanceInMs=0,this._drawPerformanceInMs=0,this.startLoop()},R._mainLoop=function(t){var i;R._animationFrameHandle=requestAnimationFrame(R._mainLoop),R._drawHz=t-rt._lastDrawTime,(rt._lastDrawTime=t)>rt._nextUpdateTime&&(R._updateHz=t-rt._lastUpdateTime,rt._lastUpdateTime=t,rt._nextUpdateTime=t+13,i=performance.now(),R._updateFn(),rt._fixedUpdateCount++,25<R._updateHz&&(R._updateFn(),rt._fixedUpdateCount++),R._updatePerformanceInMs=performance.now()-i);var e=performance.now();R._drawFn(),R._drawPerformanceInMs=performance.now()-e},R.startLoop=function(){this._animationFrameHandle=requestAnimationFrame(R._mainLoop)},R.shutDown=function(){cancelAnimationFrame(this._animationFrameHandle)},R);function R(){}var nt=(X.init=function(){this._width=n,this._height=h,this._centerX=.5*this._width,this._centerY=.5*this._height,this._scale=1,this._isVisible=!0},X);function X(){}var Y=function(){this.axis=[],this.buttons=[]},L=(M.init=function(){this._keyDown={},this._mousePositionX=0,this._mousePositionY=0,this._mouseButtonDown={},this._touchDown=!1,this._leftThumbStickDown=!1,this._leftThumbStickX=0,this._leftThumbStickY=0,this._rightThumbStickDown=!1,this._rightThumbStickX=0,this._rightThumbStickY=0,this._gamepads={},this._gamepadsCount=0},M.inputMessage=function(t){switch(t[0]){case V.KeyUp:this._keyDown[t[1]]=!1;break;case V.KeyDown:this._keyDown[t[1]]=!0;break;case V.TouchDown:this._mousePositionX=t[1],this._mousePositionY=t[2],this._touchDown=!0;break;case V.TouchMove:this._mousePositionX=t[1],this._mousePositionY=t[2];break;case V.TouchEnd:this._mousePositionX=t[1],this._mousePositionY=t[2],this._touchDown=!1;break;case V.MouseDown:this._mouseButtonDown[t[1]]=!0;break;case V.MouseUp:this._mouseButtonDown[t[1]]=!1;break;case V.MouseMove:this._mousePositionX=t[1],this._mousePositionY=t[2];break;case V.GamepadConnected:this._gamepads[t[1]]=new Y,this._gamepadsCount++;break;case V.GamepadDisconnected:delete this._gamepads[t[1]],this._gamepadsCount--;break;case V.GamepadAxis:this._gamepads[t[1]].axis[t[2]]=t[3];break;case V.GamepadButton:this._gamepads[t[1]].buttons[t[2]]=t[3];break;case V.LeftThumbStickDown:this._leftThumbStickDown=t[1];break;case V.LeftThumbStickX:this._leftThumbStickX=t[1];break;case V.LeftThumbStickY:this._leftThumbStickY=t[1];break;case V.RightThumbStickDown:this._rightThumbStickDown=t[1];break;case V.RightThumbStickX:case V.RightThumbStickX:this._rightThumbStickX=t[1]}},M);function M(){}var ht=(O.init=function(){this._x=0,this._y=0,this.offsetX=0,this.offsetY=0,this.rotation=0,this.set(0,0)},O.set=function(t,i){this._x=t-O.offsetX,this._y=i-O.offsetY,this._worldTop=this._y-nt._centerY,this._worldBottom=this._y+nt._centerY,this._worldLeft=this._x-nt._centerX,this._worldRight=this._x+nt._centerX},O);function O(){}var I=(H.playSound=function(t){postMessage([V.PlaySound,t])},H.stopSound=function(t){postMessage([V.StopSound,t])},H.playMusic=function(t){postMessage([V.PlayMusic,t])},H.stopMusic=function(t){postMessage([V.StopMusic,t])},H);function H(){}var W=(j.init=function(){this._textFrameDelay=10,this._nextTextUpdateFrame=0,this._isActive=!0,this._debugText=lt.createEntity(nt._centerX,nt._height-6,9),this._debugText.setText(""),this._debugText.colorTintR=1,this._debugText.colorTintG=0,this._debugText.colorTintB=1,this._debugText.colorTintA=1,this._debugText.ui=!0,this._debugText.setScale(.8,.8)},j.fixedUpdate=function(){this._nextTextUpdateFrame<rt._fixedUpdateCount&&(this._nextTextUpdateFrame=rt._fixedUpdateCount+this._textFrameDelay,this._debugText.setText("u:"+U._updateHz.toFixed(2)+"("+U._updatePerformanceInMs.toFixed(2)+") d:"+U._drawHz.toFixed(2)+"("+U._drawPerformanceInMs.toFixed(2)+") e:"+B._allEntities.length))},j.draw=function(){},j);function j(){}var z=(G.prototype.addToPool=function(t){this._entities.push(t),t._active&&t.setActive(!1),(t._currentObjectPool=this)._size++,t._active||this._availableCount++},G.prototype.removeFromPool=function(t){for(var i=0;i<this._entities.length;i++){var e=this._entities[i];if(t._id==e._id){this._entities.splice(i,1);break}}t._currentObjectPool=null,this._size--,t._active||this._availableCount--},G.prototype.getAvailableEntity=function(){for(var t=0;t<this._entities.length;t++){var i=this._entities[t];if(!i._active)return i.setActive(!0),i}return console.error("pool is too small for Entity with tag: "+this._entities[0].tag+"!"),null},G.prototype.setAllAvailable=function(t){for(var i=0;i<this._entities.length;i++){this._entities[i].setActive(!t)}},G);function G(){this._entities=[],this._availableCount=0,this._size=0}var N=(J.init=function(t){this._workerLocalStorage=t},J.save=function(t,i){this._workerLocalStorage[t]=i,postMessage([V.SaveToRealStorage,t,i])},J.load=function(t){return this._workerLocalStorage[t]},J);function J(){}var V,K,_t=(q.init=function(){this._texturesById={},this._texturesByType={}},q.preloadImagesFromMap=function(t){for(var i=0;i<this._map._tilesets.length;i++){var e=this._map._tilesets[i];e._image&&p.createImage(e._image._source);for(var s=0;s<e._tiles.length;s++){var a=e._tiles[s];a._image&&p.createImage(a._image._source)}}p.setOnLoadedCallback(function(){t()})},q._searchAndAddTexture=function(t,i,e){if(!this._texturesById[i])for(var s=i-t._firstgid,a=0,o=0,r=0;r<t._tilecount;r++){if(a==t._columns&&(a=0,o++),r==s){var n=a*t._tilewidth,h=o*t._tileheight;this._texturesById[i]=new m(e._source,t._tilewidth,t._tileheight,n,h);break}a++}},q.getTilesetForTileNumber=function(t){for(var i=this._map._tilesetIds.length-1;0<=i;i--){var e=this._map._tilesetIds[i];if(e<=t)return this._map._tilesetsByFirstId[e]}return null},q.createTextures=function(){for(var t,i=0;i<this._map._tileIds.length;i++){var e=this._map._tileIds[i],s=this.getTilesetForTileNumber(e);if(s){var a=s._image;if(a){for(var o=0;o<s._tiles.length;o++){if((d=s._tiles[o])._animation)for(var r=0;r<(null===(t=d._animation)||void 0===t?void 0:t.length);r++){var n=d._animation[r]._id;this._searchAndAddTexture(s,n,a)}if(d._type){var h=d._id+s._firstgid;this._texturesById[h]||this._searchAndAddTexture(s,h,a),this._texturesByType[d._type]||(this._texturesByType[d._type]=[]);for(var _=!1,l=0;l<this._texturesByType[d._type].length;l++){if(this._texturesByType[d._type][l]==this._texturesById[h]){_=!0;break}}_||this._texturesByType[d._type].push(this._texturesById[h])}}this._texturesById[e]||this._searchAndAddTexture(s,e,a)}else for(var d,c=0;c<s._tiles.length;c++){if(e==(d=s._tiles[c])._id+s._firstgid){(a=d._image)&&(this._texturesById[e]=new m(a._source));break}}}}},q.addSpriteFromAnimation=function(t,i){q._map._animationsByType[i]||console.error("Animation Name Not Found!");for(var e=q._map._animationsByType[i],s=q._texturesById[e[0]._id],a=t.addSprite(s),o=0;o<e.length;o++){var r=e[o];a.addAnimationFrame(q._texturesById[e[o]._id],r._duration)}return a},q);function q(){}(K=V=V||{})[K.InitWorker=0]="InitWorker",K[K.WorkerInitialized=1]="WorkerInitialized",K[K.PlaySound=2]="PlaySound",K[K.StopSound=3]="StopSound",K[K.PlayMusic=4]="PlayMusic",K[K.StopMusic=5]="StopMusic",K[K.KeyUp=6]="KeyUp",K[K.KeyDown=7]="KeyDown",K[K.TouchDown=8]="TouchDown",K[K.TouchMove=9]="TouchMove",K[K.TouchEnd=10]="TouchEnd",K[K.LeftThumbStickDown=11]="LeftThumbStickDown",K[K.LeftThumbStickX=12]="LeftThumbStickX",K[K.LeftThumbStickY=13]="LeftThumbStickY",K[K.RightThumbStickDown=14]="RightThumbStickDown",K[K.RightThumbStickX=15]="RightThumbStickX",K[K.RightThumbStickY=16]="RightThumbStickY",K[K.MouseDown=17]="MouseDown",K[K.MouseUp=18]="MouseUp",K[K.MouseMove=19]="MouseMove",K[K.GamepadConnected=20]="GamepadConnected",K[K.GamepadDisconnected=21]="GamepadDisconnected",K[K.GamepadAxis=22]="GamepadAxis",K[K.GamepadButton=23]="GamepadButton",K[K.MuteSound=24]="MuteSound",K[K.UnmuteSound=25]="UnmuteSound",K[K.MuteMusic=26]="MuteMusic",K[K.UnmuteMusic=27]="UnmuteMusic",K[K.CanvasWasScaled=28]="CanvasWasScaled",K[K.SaveToRealStorage=29]="SaveToRealStorage",K[K.VisibilityChanged=30]="VisibilityChanged",onmessage=function(t){var i,e=t.data[0];switch(null!==(i=lt._setup)&&void 0!==i&&i.messageCallback&&lt._setup.messageCallback(t),e){case V.InitWorker:var s=t.data[1];lt._canvas=s.canvas,lt._canPlaySoundAtStartup=s.canPlaySoundOnStartUp,lt._locationHref=s.locationHref,lt._tiledMap=s.tiledMap,N.init(s.vaultData),lt.entryPoint(),postMessage([V.WorkerInitialized]);break;case V.CanvasWasScaled:nt._scale=t.data[1],lt._canvas.width=n*nt._scale,lt._canvas.height=h*nt._scale;break;case V.VisibilityChanged:var a=t.data[1];(nt._isVisible=a)?U.startLoop():U.shutDown();break;case V.KeyUp:case V.KeyDown:case V.TouchDown:case V.TouchMove:case V.TouchEnd:case V.MouseDown:case V.MouseUp:case V.MouseMove:case V.LeftThumbStickDown:case V.LeftThumbStickX:case V.LeftThumbStickY:case V.RightThumbStickDown:case V.RightThumbStickX:case V.RightThumbStickY:case V.GamepadConnected:case V.GamepadDisconnected:case V.GamepadAxis:case V.GamepadButton:L.inputMessage(t.data)}};var Z,Q,$,tt,it,et,st,at=function(t,i){this.messageCallback=null,this._start=t,this._fixedUpdate=i},lt=(ot.preload=function(t,i){this._setup=t,nt.init(),p.init(),_t.init(),w.init(),L.init(),this._tiledMap?(_t._map=this._tiledMap,_t.preloadImagesFromMap(function(){_t.createTextures(),i()})):i()},ot.init=function(t){ot.setDefaultFont(t),B.init(),-1<ot._locationHref.indexOf("debug=true")&&W.init(),rt.init(),ht.init(),U.init(ot._fixedUpdate,ot._draw),this._setup._start()},ot._fixedUpdate=function(){B.fixedUpdate(),ot._setup._fixedUpdate(),W._isActive&&W.fixedUpdate()},ot._draw=function(){B.draw(),W._isActive&&W.draw()},ot.createEntity=function(t,i,e){void 0===e&&(e=0);var s=new A(t,i);return s._id=B._uniqueId++,s._layer=e,B._entitiesByLayers[e].push(s),B._allEntities.push(s),s},ot.removeEntity=function(t){t._markedForRemoval=!0},ot.setDefaultFont=function(t){this._defaultFont=t},ot.shutDown=function(){U.shutDown()},ot);function ot(){}(Z={})[Z.Idle=0]="Idle",Z[Z.GoingBackward=1]="GoingBackward",Z[Z.GoingForward=2]="GoingForward",($=Q=Q||{})[$.Start=0]="Start",$[$.Default=1]="Default",$[$.Hit=2]="Hit",$[$.FallRecovery=3]="FallRecovery",$[$.Dead=4]="Dead",$[$.EndAcending=5]="EndAcending",$[$.Finished=6]="Finished",(it=tt=tt||{})[it.None=0]="None",it[it.Jumping=1]="Jumping",it[it.Crouching=2]="Crouching",it[it.Landing=3]="Landing",(st=et=et||{})[st.Up=0]="Up",st[st.UpRight=1]="UpRight",st[st.Right=2]="Right";var dt=(ct.init=function(){var t=this;this._maxMoveSpeed=_e._spectator?7:3,this._forwardSpeed=_e._spectator?0:2,this._sinJump=[-12,-7,-4,-2,-1,0,0,0,1,2,4,7,10],this._updateDelayOnJump=2,this._nextSinJumpTime=0,this._currentJumpFrame=0,this._currentMovementSpeed=0,this._playerState=Q.Start,this._playerDefaultSubstate=tt.None,this._lastVelocityX=0,this._maxLives=_e._spectator?100:3,this._nextShotTime=rt._fixedUpdateCount+60,this._score=0,this._lives=this._maxLives,this._hitTimeout=30,this._grounded=!0,this._jumpMultiplier=1,this._nextIncrementMovementX=0,this._canShootUp=!0,this._canShootUpRight=!0,this._canShootRight=!0,this._canShootWithTrigger=!0,this._colliderWidth=16,this._colliderHeight=32,this._shootDirection=et.Right;for(var i=nt._centerX,e=153,s=0;s<_t._map._objectgroups.length;s++){var a=_t._map._objectgroups[s];"Player"==a._name&&(i=a._offsetx,e=a._offsety)}var o=lt.createEntity(i,e,$i.Characters);o.tag=ie.Player,this._spriteWheelStopped=o.addSprite(_t._texturesByType.playerWheelStopped[0]),this._spriteWheelStopped.drawOffsetX=-3,this._spriteWheelStopped.drawOffsetY=6,this._spriteWheelTurning=_t.addSpriteFromAnimation(o,"playerWheelGoing"),this._spriteWheelTurning.drawOffsetX=-3,this._spriteWheelTurning.drawOffsetY=6,this._spriteWheelTurning.active=!1,this._spriteWheelStarting=_t.addSpriteFromAnimation(o,"playerWheelStarting"),this._spriteWheelStarting.drawOffsetX=-3,this._spriteWheelStarting.drawOffsetY=6,this._spriteWheelStarting.repeatAnimation(!1),this._spriteWheelStarting.animationFinishedCallback=function(){t._spriteWheelStarting.active=!1,0==t._rigidBody.velocityX?(t._spriteWheelTurning.active=!1,t._spriteWheelStopped.active=!0):(t._spriteWheelTurning.active=!0,t._spriteWheelStopped.active=!1)},this._spriteWheelStarting.active=!1,this._spriteWheelDirt=_t.addSpriteFromAnimation(o,"playerWheelSmoke"),this._spriteWheelDirt.drawOffsetX=-10,this._spriteWheelDirt.drawOffsetY=-1,this._spriteWheelDirt.repeatAnimation(!1),this._spriteWheelDirt.animationFinishedCallback=function(){t._spriteWheelDirt.active=!1},this._spriteWheelDirt.active=!1;var r=_t._texturesById[_t._map._animationsByType.playerDodge[0]._id];this._spriteDodge=o.addSprite(r,0,-14),this._spriteDodge.active=!1,this._spriteIdle=_t.addSpriteFromAnimation(o,"playerIdle"),this._spriteIdle.drawOffsetY=-14,this._spriteHit=_t.addSpriteFromAnimation(o,"playerHit"),this._spriteHit.drawOffsetY=-14,this._spriteHit.active=!1,this._spriteJump=_t.addSpriteFromAnimation(o,"playerJump"),this._spriteJump.drawOffsetY=-14,this._spriteJump.active=!1,this._spriteJump.repeatAnimation(!1),this._spriteLanding=_t.addSpriteFromAnimation(o,"playerLanding"),this._spriteLanding.drawOffsetY=-14,this._spriteLanding.active=!1,this._spriteLanding.repeatAnimation(!1),this._spriteLanding.animationFinishedCallback=function(){t._playerDefaultSubstate=tt.None,t._spriteIdle.active=!0,t._spriteDodge.active=!1,t._spriteHit.active=!1,t._spriteJump.active=!1,t._spriteLanding.active=!1},this._spriteDeath=_t.addSpriteFromAnimation(o,"playerDeath"),this._spriteDeath.drawOffsetY=-9,this._spriteDeath.drawOffsetX=-1,this._spriteDeath.active=!1,this._spriteDeath.repeatAnimation(!1),this._spriteDeath.animationFinishedCallback=function(){t._spriteDeath.active=!1},this._gunSprite=_t.addSpriteFromAnimation(o,"playerGunAnimation"),this._gunSprite.drawOffsetX=-10,this._gunSprite.drawOffsetY=-17,this._gunSprite.repeatAnimation(!1),this._gunSprite.playAnimation(),this._gunTextureRight=_t._texturesByType.playerGunRight[0],this._gunTextureUpRight=_t._texturesByType.playerGunRightUp[0],this._gunTextureUp=_t._texturesByType.playerGunUp[0],this._spriteMuzzleFlashUp=_t.addSpriteFromAnimation(o,"playerMuzzleFlashUp"),this._spriteMuzzleFlashUp.drawOffsetX=-4,this._spriteMuzzleFlashUp.drawOffsetY=-7,this._spriteMuzzleFlashUp.repeatAnimation(!1),this._spriteMuzzleFlashUp.active=!1,this._spriteMuzzleFlashUp.animationFinishedCallback=function(){t._spriteMuzzleFlashUp.active=!1},this._spriteMuzzleFlash45deg=_t.addSpriteFromAnimation(o,"playerMuzzleFlash45deg"),this._spriteMuzzleFlash45deg.drawOffsetX=1,this._spriteMuzzleFlash45deg.drawOffsetY=-7,this._spriteMuzzleFlash45deg.repeatAnimation(!1),this._spriteMuzzleFlash45deg.active=!1,this._spriteMuzzleFlash45deg.animationFinishedCallback=function(){t._spriteMuzzleFlash45deg.active=!1},this._spriteMuzzleFlashForward=_t.addSpriteFromAnimation(o,"playerMuzzleFlashForward"),this._spriteMuzzleFlashForward.drawOffsetX=4,this._spriteMuzzleFlashForward.drawOffsetY=-1,this._spriteMuzzleFlashForward.repeatAnimation(!1),this._spriteMuzzleFlashForward.active=!1,this._spriteMuzzleFlashForward.animationFinishedCallback=function(){t._spriteMuzzleFlashForward.active=!1};var n=o.addCollider(this._colliderWidth,this._colliderHeight);n.type=k.Dynamic,n.collisionEdgeRight=!1,n.collisionEdgeLeft=!1,n.offsetX=0,n.offsetY=-1,n.slopeOffsetLeft=-3,n.slopeOffsetRight=-8,n.safeAreaBottom=6,o.rigidBody=new T,o.rigidBody.gravityEnabledY=!1,this._collider=n,this._player=o,this._rigidBody=o.rigidBody;var h=N.load(_e._highScoreKey);h||(h="0",N.save(_e._highScoreKey,h)),this._lastHighScore=parseInt(h,10),this._teleportDelay=-1},ct.fixedUpdate=function(){switch(this._checkCollisions(),this._playerState){case Q.Start:case Q.Default:this._processInputForMovement(),this._processInputForGun(),this._processMovement(),this._checkFallRecovery();break;case Q.Hit:this._processInputForMovement(),this._processMovement(),this._checkFallRecovery(),rt._fixedUpdateCount%4==0?this._spriteHit.active=!1:this._spriteHit.active=!0,this._hitTimeout<rt._fixedUpdateCount&&(this._playerState=Q.Default,this._spriteIdle.active=!0,this._spriteDodge.active=!1,this._spriteHit.active=!1,this._spriteJump.active=!1,this._spriteLanding.active=!1,0<this._player._sprites.length&&(this._player.colorTintA=1));break;case Q.FallRecovery:this._processInputForMovement(),this._processMovement(),rt._fixedUpdateCount%4==0?this._spriteHit.active=!1:this._spriteHit.active=!0,this._player.rigidBody&&(this._player.rigidBody.velocityY=-8),this._hitTimeout<rt._fixedUpdateCount&&(this._collider.collisionEdgeTop=!0,this._collider.collisionEdgeBottom=!0,0<this._player._sprites.length&&(this._player.colorTintA=1),this._playerState=Q.Hit,this._hitTimeout=this._hitTimeout=rt._fixedUpdateCount+50,this._triggerJump());break;case Q.EndAcending:this._processMovement(),this._player.x<ht._x&&ht.offsetX++,this._player.x>ht._x&&ht.offsetX--;break;case Q.Finished:-1!=this._teleportDelay&&this._teleportDelay<rt._fixedUpdateCount&&(this._player.colorTintA-=.1,this._player.colorTintA<0&&(Zt.gameOver(),this._teleportDelay=-1));break;case Q.Dead:}},ct._checkCollisions=function(){if(this._player._colliderCount)for(var t=this._collider,i=0;i<t._hitCount;i++){var e,s,a,o,r,n,h,_,l,d,c,p,u,g,f,y,m,v=t._hits[i];switch(v._entity.tag){case ie.CameraMoveUp:Xi.triggerOffsetY(Xi._currentOffsetY-192,0),v._entity.setActive(!1),Ht.fadeOutBuildingsBack=!0;break;case ie.CameraMoveDown:Xi.triggerOffsetY(Xi._currentOffsetY+192,0),v._entity.setActive(!1),Ht.fadeInBuildingsBack=!0;break;case ie.TunnelUpTrigger:Xi.triggerOffsetY(Xi._currentOffsetY-48,0),v._entity.setActive(!1);break;case ie.TunnelDownTrigger:Xi.triggerOffsetY(Xi._currentOffsetY+48,0),v._entity.setActive(!1);break;case ie.End:this._triggerEndAcension(),v._entity.setActive(!1);break;case ie.EndGate:this._playerState=Q.Finished,this._rigidBody.velocityX=0,this._rigidBody.velocityY=0}this._playerState==Q.Default&&(e=v._entity.tag==ie.Drone1Projectile,s=v._entity.tag==ie.Drone2Projectile,a=v._entity.tag==ie.Drone4Projectile,o=v._entity.tag==ie.GroundDrone1,r=v._entity.tag==ie.GroundDrone2,n=v._entity.tag==ie.TurretProjectile,h=v._entity.tag==ie.TunnelTrap1,_=v._entity.tag==ie.SlimeTrap1,l=v._entity.tag==ie.FireTrap1,d=v._entity.tag==ie.PoisonTrap1,c=v._entity.tag==ie.FlyingDrone3,p=v._entity.tag==ie.RailTurret1,u=v._entity.tag==ie.RailCart1,g=v._entity.tag==ie.RailCart2,f=v._entity.tag==ie.GroundTurret1,y=v._entity.tag==ie.SlimeDrip,m=v._entity.tag==ie.FlyingDrone5,(e||o||r||n||a||_||s||h||l||d||c||p||u||g||f||y||m)&&(se._downButtonDown&&this._standUp(),0==this._lives?this._killPlayer():(this._spriteIdle.active=!1,this._spriteDodge.active=!1,this._spriteHit.active=!0,this._spriteJump.active=!1,this._spriteLanding.active=!1,this._playerState=Q.Hit,this._playerDefaultSubstate=tt.None,this._hitTimeout=rt._fixedUpdateCount+70,I.playSound("assets/Audio/crash1.ogg"),this._reduceLives())))}},ct._processInputForMovement=function(){var t,i;switch(se._upButtonDown||this._canJump||(this._canJump=!0),se._leftButtonDown?(1<this._lastVelocityX&&(this._spriteWheelStopped.active=!1,this._spriteWheelTurning.active=!0),this._spriteWheelStopped.active=!1,this._spriteWheelTurning.active=!0,this._nextIncrementMovementX<=rt._fixedUpdateCount&&(t=this._grounded?3:2,this._nextIncrementMovementX=rt._fixedUpdateCount+t,this._currentMovementSpeed--,this._currentMovementSpeed=Math.max(this._currentMovementSpeed,-this._maxMoveSpeed)),L._leftThumbStickDown&&(this._currentMovementSpeed=Math.max(-this._maxMoveSpeed,L._leftThumbStickX*this._maxMoveSpeed))):se._rightButtonDown&&(this._lastVelocityX<=this._forwardSpeed&&!this._spriteWheelStarting.active&&this._startWheels(),this._nextIncrementMovementX<=rt._fixedUpdateCount&&(t=this._grounded?6:4,this._nextIncrementMovementX=rt._fixedUpdateCount+t,this._currentMovementSpeed++,i=_e._spectator||this._playerState==Q.Start?0:1,this._currentMovementSpeed=Math.min(this._currentMovementSpeed,this._maxMoveSpeed-i)),L._leftThumbStickDown&&(this._currentMovementSpeed=Math.min(this._maxMoveSpeed,L._leftThumbStickX*this._maxMoveSpeed))),this._playerDefaultSubstate){case tt.Landing:case tt.None:this._playerState!=Q.Hit&&se._downButtonDown&&this._grounded&&(this._collider.set(this._colliderWidth,this._colliderHeight-6),this._collider.offsetY=2,this._playerDefaultSubstate=tt.Crouching,this._spriteIdle.active=!1,this._spriteDodge.active=!0,this._spriteHit.active=!1,this._spriteJump.active=!1,this._spriteLanding.active=!1,this._spriteDodge.setAnimationX(4,3,!1)),se._upButtonDown&&this._grounded&&this._canJump&&this._triggerJump();break;case tt.Jumping:break;case tt.Crouching:se._downButtonDown&&this._grounded||this._standUp(),se._upButtonDown&&this._grounded&&this._canJump&&this._triggerJump()}},ct.switchGunDirection=function(t){if(this._shootDirection!=t)switch(this._shootDirection=t){case et.UpRight:this._gunSprite.setTexture(this._gunTextureUpRight);break;case et.Up:this._gunSprite.setTexture(this._gunTextureUp);break;case et.Right:this._gunSprite.setTexture(this._gunTextureRight)}},ct._shoot=function(){var t=_i._playerProjectiles.getAvailableEntity();if(t){var i=t.fixedUpdate;switch(this._nextShotTime=rt._fixedUpdateCount+13,this._shootDirection){case et.UpRight:i.init(this._player.x+4,this._player.y-9,si.Deg45),this._spriteMuzzleFlash45deg.active=!0,this._spriteMuzzleFlash45deg.playAnimation();break;case et.Up:i.init(this._player.x-4,this._player.y-11,si.Up),this._spriteMuzzleFlashUp.active=!0,this._spriteMuzzleFlashUp.playAnimation();break;case et.Right:i.init(this._player.x+3,this._player.y-2,si.Forward),this._spriteMuzzleFlashForward.active=!0,this._spriteMuzzleFlashForward.playAnimation()}}},ct._processInputForGun=function(){this._nextShotTime<rt._fixedUpdateCount&&((se._action1ButtonDown||se._action2ButtonDown)&&(this._canShootUpRight&&se._action1ButtonDown&&se._action2ButtonDown?(this.switchGunDirection(et.UpRight),this._shoot(),this._canShootUp=!1,this._canShootUpRight=!1,this._canShootRight=!1):this._canShootUp&&se._action1ButtonDown?(this.switchGunDirection(et.Up),this._shoot(),this._canShootUp=!1):this._canShootRight&&se._action2ButtonDown&&(this.switchGunDirection(et.Right),this._shoot(),this._canShootRight=!1)),se._triggerButton1Down&&this._canShootWithTrigger&&(this._shoot(),this._canShootWithTrigger=!1)),this._canShootWithTrigger||se._triggerButton1Down||(this._canShootWithTrigger=!0),this._canShootUpRight||se._action1ButtonDown&&se._action2ButtonDown||(this._canShootUpRight=!0),this._canShootUp||se._action1ButtonDown||(this._canShootUp=!0),this._canShootRight||se._action2ButtonDown||(this._canShootRight=!0)},ct._processPhysics=function(){this._playerDefaultSubstate!=tt.Jumping&&(this._rigidBody.velocityY+=1,this._rigidBody.velocityY=Math.min(this._rigidBody.velocityY,10))},ct._startWheels=function(){this._spriteWheelStopped.active=!1,this._grounded?(this._spriteWheelTurning.active=!1,this._spriteWheelStarting.active=!0,this._spriteWheelStarting.playAnimation(),this._spriteWheelDirt.active=!0,this._spriteWheelDirt.playAnimation()):this._spriteWheelTurning.active=!0},ct._processMovement=function(){switch(this._currentMovementSpeed<0&&this._nextIncrementMovementX<=rt._fixedUpdateCount&&this._grounded?(this._nextIncrementMovementX=rt._fixedUpdateCount+4,this._currentMovementSpeed++,0<this._currentMovementSpeed&&(this._currentMovementSpeed=0)):0<this._currentMovementSpeed&&this._nextIncrementMovementX<=rt._fixedUpdateCount&&this._grounded&&(this._nextIncrementMovementX=rt._fixedUpdateCount+4,this._currentMovementSpeed--,this._currentMovementSpeed<0&&(this._currentMovementSpeed=0)),(this._player.x<=ht._x-nt._centerX&&this._currentMovementSpeed<0||this._player.x>=ht._x+nt._centerX&&0<this._currentMovementSpeed)&&(this._currentMovementSpeed=0),_e._spectator&&this._playerState!=Q.Start||(ht.offsetX+=this._currentMovementSpeed),this._rigidBody.velocityX=this._currentMovementSpeed,this._playerState!=Q.Start&&(this._rigidBody.velocityX+=this._forwardSpeed),this._rigidBody.velocityX!=this._lastVelocityX&&0==this._rigidBody.velocityX&&this._playerState==Q.Start&&(this._spriteWheelStopped.active=!0,this._spriteWheelTurning.active=!1),this._lastVelocityX=this._rigidBody.velocityX,!this._grounded&&this._collider.touchingBottom&&this._playerState!=Q.Hit&&(this._playerDefaultSubstate=tt.Landing,this._spriteIdle.active=!1,this._spriteDodge.active=!1,this._spriteHit.active=!1,this._spriteJump.active=!1,this._spriteLanding.active=!0,this._spriteLanding.playAnimation()),this._playerDefaultSubstate){case tt.None:this._processPhysics();break;case tt.Jumping:this._collider.touchingTop&&(this._playerDefaultSubstate=tt.None),rt._fixedUpdateCount>=this._nextSinJumpTime&&this._forwardJumpMovement();break;case tt.Crouching:case tt.Landing:this._processPhysics()}this._grounded=this._collider.touchingBottom},ct._checkFallRecovery=function(){this._player.y>ht._y+nt._height&&(0==this._lives?this._killPlayer():(this._playerState=Q.FallRecovery,this._currentMovementSpeed=0,this._hitTimeout=rt._fixedUpdateCount+30,this._collider.collisionEdgeTop=!1,this._collider.collisionEdgeBottom=!1,this._spriteIdle.active=!1,this._spriteDodge.active=!1,this._spriteHit.active=!0,this._spriteJump.active=!1,this._spriteLanding.active=!1,this._currentMovementSpeed=0,I.playSound("assets/Audio/crash1.ogg"),0<this._player._sprites.length&&(this._player.colorTintA=.5),this._reduceLives()))},ct._standUp=function(){this._collider.set(this._colliderWidth,this._colliderHeight),this._collider.offsetY=-1,this._playerDefaultSubstate=tt.None,this._spriteIdle.active=!0,this._spriteDodge.active=!1,this._spriteHit.active=!1,this._spriteJump.active=!1,this._spriteLanding.active=!1,this._spriteDodge.resetAnimationX()},ct._triggerJump=function(t){void 0===t&&(t=1),this._playerState!=Q.Hit&&(this._playerDefaultSubstate=tt.Jumping,this._spriteIdle.active=!1,this._spriteDodge.active=!1,this._spriteHit.active=!1,this._spriteJump.active=!0,this._spriteLanding.active=!1,this._spriteWheelDirt.active=!1,this._spriteJump.playAnimation(),I.playSound("assets/Audio/jump1.ogg")),this._currentJumpFrame=0,this._forwardJumpMovement(),this._jumpMultiplier=t,this._canJump=!1},ct._forwardJumpMovement=function(){this._rigidBody.velocityY=this._sinJump[this._currentJumpFrame]*this._jumpMultiplier,this._nextSinJumpTime=rt._fixedUpdateCount+this._updateDelayOnJump,this._currentJumpFrame++,this._currentJumpFrame==this._sinJump.length&&(this._playerDefaultSubstate=tt.None)},ct._reduceLives=function(){this._lives--,Zt.setLives(this._lives)},ct.addToLives=function(){this._lives++,Zt.setLives(this._lives)},ct._killPlayer=function(){var t=this;this._playerState=Q.Dead,this._rigidBody.velocityX=0,this._rigidBody.velocityY=0,this._spriteIdle.active=!1,this._spriteDodge.active=!1,this._spriteHit.active=!0,this._spriteJump.active=!1,this._spriteLanding.active=!1,this._spriteHit.repeatAnimation(!1),this._spriteHit.playAnimation(),this._spriteHit.animationFinishedCallback=function(){t._spriteHit.active=!1,t._spriteDeath.active=!0,t._spriteWheelDirt.active=!1,t._spriteWheelStopped.active=!1,t._spriteWheelStarting.active=!1,t._spriteWheelTurning.active=!1,t._spriteWheelDirt.active=!1,t._gunSprite.active=!1,t._spriteDeath.playAnimation()},I.playSound("assets/Audio/crash1.ogg"),Zt.gameOver()},ct.addToScore=function(t,i,e){this._score+=t,Zt.setScore(this._score);var s=Zt._scoreIndicators.getAvailableEntity();s&&s.fixedUpdate.init(t.toString(),i,e)},ct._triggerEndAcension=function(){_e._spectator||(this._playerState=Q.EndAcending,this._playerDefaultSubstate==tt.Crouching&&this._standUp())},ct.triggerTeleportAway=function(){this._player.colorTintR=5,this._player.colorTintG=5,this._player.colorTintB=5,this._teleportDelay=rt._fixedUpdateCount+5},ct.triggerBeginRun=function(){this._playerState=Q.Default,this._startWheels()},ct);function ct(){}var pt=(ut.prototype.fixedUpdate=function(t){for(var i=t._colliders[0],e=0;e<i._hitCount;e++){if(i._hits[e]._entity.tag==ie.Player){this._playerHitObstacle=!0;break}}!this._playerHitObstacle&&!this._playerHasPassedObstacle&&dt._player.x>t.x&&(dt.addToScore(this._passedItScore,t.x,t.y),this._playerHasPassedObstacle=!0)},ut.prototype.reset=function(){this._playerHasPassedObstacle=!1,this._playerHitObstacle=!1},ut);function ut(t){this._playerHitObstacle=!1,this._playerHasPassedObstacle=!1,this._passedItScore=t}var gt=(ft.prototype.fixedUpdate=function(t){this._playerPassedObstacleScript.fixedUpdate(t),t.x<ht._x-nt._centerX&&this._recycle(t)},ft.prototype._recycle=function(t){this._playerPassedObstacleScript.reset(),t.setActive(!1)},ft);function ft(t){for(var i=_t._map._animationsByType.obstacle1,e=t.addSprite(_t._texturesById[i[0]._id]),s=0;s<i.length;s++){var a=i[s];e.addAnimationFrame(_t._texturesById[a._id],a._duration)}this._playerPassedObstacleScript=new pt(10),t.tag=ie.SlimeTrap1,t.setActive(!1);var o=t.addCollider(14,17);o.collisionEdgeTop=!1,o.collisionEdgeLeft=!1,o.collisionEdgeRight=!1,o.collisionEdgeBottom=!1,o.offsetX=-6,o.offsetY=8,o.tagFilter=ie.PlayerProjectile}var yt=(mt.prototype.reset=function(){this._collider.offsetY=4,this._nextAttackDelay=7},mt.prototype.fixedUpdate=function(t){if(this._playerPassedObstacleScript.fixedUpdate(t),this._lastFrameNumber!=this._sprite._currentFrameX)switch(this._lastFrameNumber=this._sprite._currentFrameX,this._sprite._currentFrameX){case 0:this._collider.offsetY=4;break;case 1:this._collider.offsetY=3;break;case 2:this._collider.offsetY=2;break;case 3:this._collider.offsetY=3;break;case 4:this._collider.offsetY=4;break;case 5:this._collider.offsetY=16;break;case 6:this._collider.offsetY=32;break;case 7:this._collider.offsetY=48,I.playSound("assets/Audio/hit1.ogg");break;case 8:this._collider.offsetY=48;break;case 9:this._collider.offsetY=45;break;case 10:this._collider.offsetY=36;break;case 11:this._collider.offsetY=9}t.x+this._sprite._texture._halfWidth<ht._x-nt._centerX&&this._recycle(t)},mt.prototype._recycle=function(t){this._playerPassedObstacleScript.reset(),t.setActive(!1)},mt);function mt(t){var i=_t._texturesById[_t._map._animationsByType.tunnelTrap1[0]._id];t.tag=ie.TunnelTrap1,t.setActive(!1),t.addSprite(i,0,3);var e=t.addCollider(32,32);e.collisionEdgeTop=!1,e.collisionEdgeLeft=!1,e.collisionEdgeRight=!1,e.collisionEdgeBottom=!1,e.offsetY=0,this._nextAnimationFrameTime=0,this._playerPassedObstacleScript=new pt(20),this._nextAttackDelay=0,this._nextColliderPosition=0,this._lastFrameNumber=0,this._collider=t._colliders[0],this._collider.offsetX=-27,this._collider.type=k.Dynamic,this._sprite=t._sprites[0],this._sprite.setAnimationX(5,12,!0),this.reset()}var vt=(xt.prototype.fixedUpdate=function(t){1==this._sprite._currentFrame?this._collider.active=!0:6==this._sprite._currentFrame&&(this._collider.active=!1),this._playerPassedObstacleScript.fixedUpdate(t),t.x<ht._x-nt._centerX&&this._recycle(t)},xt.prototype._recycle=function(t){this._collider.active=!1,this._playerPassedObstacleScript.reset(),t.setActive(!1)},xt);function xt(t){var i=_t._map._animationsByType.fireTrap1;this._sprite=t.addSprite(_t._texturesById[i[0]._id]);for(var e=0;e<i.length;e++){var s=i[e];this._sprite.addAnimationFrame(_t._texturesById[s._id],s._duration)}this._playerPassedObstacleScript=new pt(5),t.tag=ie.FireTrap1,t.setActive(!1);var a=t.addCollider(11,16);a.collisionEdgeTop=!1,a.collisionEdgeLeft=!1,a.collisionEdgeRight=!1,a.collisionEdgeBottom=!1,a.offsetX=1,a.offsetY=-8,a.active=!1,a.tagFilter=ie.PlayerProjectile,this._collider=a}var Tt=(St.prototype.fixedUpdate=function(t){0==this._sprite._currentFrame?this._collider.active=!0:4==this._sprite._currentFrame&&(this._collider.active=!1),this._playerPassedObstacleScript.fixedUpdate(t),t.x<ht._x-nt._centerX&&this._recycle(t)},St.prototype._recycle=function(t){this._collider.active=!0,this._playerPassedObstacleScript.reset(),t.setActive(!1)},St);function St(t){var i=_t._map._animationsByType.poisonTrap1;this._sprite=t.addSprite(_t._texturesById[i[0]._id]);for(var e=0;e<i.length;e++){var s=i[e];this._sprite.addAnimationFrame(_t._texturesById[s._id],s._duration)}this._playerPassedObstacleScript=new pt(10),t.tag=ie.PoisonTrap1,t.setActive(!1);var a=t.addCollider(24,18);a.collisionEdgeTop=!1,a.collisionEdgeLeft=!1,a.collisionEdgeRight=!1,a.collisionEdgeBottom=!1,a.offsetX=0,a.offsetY=7,a.tagFilter=ie.PlayerProjectile,this._collider=a}var wt=(bt.prototype.fixedUpdate=function(t){this._playerPassedObstacleScript.fixedUpdate(t);for(var i=0;i<this._collider._hitCount;i++){var e=this._collider._hits[i];e._entity.tag!=ie.Player&&e._entity.tag!=ie.PlayerProjectile||(this._mainSprite.active=!1,this._deathSprite.active=!0,this._deathSprite.playAnimation(),e._entity.tag==ie.PlayerProjectile&&dt.addToScore(5,t.x,t.y),this._collider.active=!1,this._collider.reset(),I.playSound("assets/Audio/explosion1.ogg"))}t.x<ht._x-nt._centerX&&this._recycle()},bt.prototype._recycle=function(){this._playerPassedObstacleScript.reset(),this._mainSprite.active=!0,this._deathSprite.active=!1,this._collider.active=!0,this._entity.setActive(!1)},bt);function bt(t){this._entity=t;var i=_t._map._animationsByType.explosionTrap1Idle;this._mainSprite=t.addSprite(_t._texturesById[i[0]._id]);for(var e=0;e<i.length;e++){var s=i[e];this._mainSprite.addAnimationFrame(_t._texturesById[s._id],s._duration)}var a=_t._map._animationsByType.explosionTrap1Triggered;this._deathSprite=t.addSprite(_t._texturesById[a[0]._id]);for(e=0;e<a.length;e++){s=a[e];this._deathSprite.addAnimationFrame(_t._texturesById[s._id],s._duration)}this._deathSprite.repeatAnimation(!1),this._deathSprite.active=!1,this._deathSprite.animationFinishedCallback=this._recycle.bind(this),this._playerPassedObstacleScript=new pt(10),t.tag=ie.SlimeTrap1,t.setActive(!1);var o=t.addCollider(16,16);o.collisionEdgeTop=!1,o.collisionEdgeLeft=!1,o.collisionEdgeRight=!1,o.collisionEdgeBottom=!1,o.offsetX=0,o.offsetY=16,this._collider=o}var Dt=(At.prototype.fixedUpdate=function(t){var i=t._colliders[0];t.x-=2;for(var e=0;e<i._hitCount;e++){i._hits[e]._entity.tag==ie.Player&&(this._hitPlayer=!0)}!this._hitPlayer&&!this._passedPlayer&&dt._player.x>t.x&&(this._passedPlayer=!0,dt.addToScore(30,t.x,t.y)),t.x<ht._x-nt._centerX-t._sprites[0]._texture._drawWidth&&this._recycle(t)},At.prototype._recycle=function(t){t.setActive(!1),this._hitPlayer=!1,this._passedPlayer=!1},At);function At(t){t.tag=ie.TurretProjectile,t.setActive(!1);for(var i=_t._map._animationsByType.groundTurret1Projectile,e=_t._texturesById[i[0]._id],s=t.addSprite(e),a=0;a<i.length;a++){var o=i[a];s.addAnimationFrame(_t._texturesById[o._id],o._duration)}var r=t.addCollider(8,8);r.offsetX=-20,r.offsetY=12,r.collisionEdgeTop=!1,r.collisionEdgeLeft=!1,r.collisionEdgeRight=!1,r.collisionEdgeBottom=!1,r.type=k.Dynamic,r.tagFilter=ie.PlayerProjectile,this._hitPlayer=!1,this._passedPlayer=!1}var Et=(Ft.prototype.fixedUpdate=function(t){this._playerPassedObstacleScript.fixedUpdate(t);var i;t._sprites[0];rt._fixedUpdateCount%4==0&&t.x+t._aabb.x1<ht._worldRight&&--t.x,this._shot||!this._activated||(i=_i._turret1Projectile.getAvailableEntity())&&(i.x=t.x-2,i.y=t.y-2,this._shot=!0,I.playSound("assets/Audio/shoot2.ogg")),!this._activated&&t.x<ht._x+nt._centerX&&(this._activated=!0),t.x+t._aabb.x2<ht._worldLeft&&this._recycle(t)},Ft.prototype._recycle=function(t){t._sprites[0].resetAnimationY(),this._activated=!1,this._shot=!1,this._playerPassedObstacleScript.reset(),t.setActive(!1)},Ft);function Ft(t){t.tag=ie.RailTurret1,t.setActive(!1);for(var i=_t._map._animationsByType.railTurret1,e=t.addSprite(_t._texturesById[i[0]._id],0,0),s=0;s<i.length;s++){var a=i[s];e.addAnimationFrame(_t._texturesById[a._id],a._duration)}var o=t.addCollider(28,28);o.collisionEdgeTop=!1,o.collisionEdgeLeft=!1,o.collisionEdgeRight=!1,o.collisionEdgeBottom=!1,o.offsetX=-6,o.offsetY=18,o.type=k.Dynamic,this._state=Bi.Default,this._shot=!1,this._activated=!1,this._playerPassedObstacleScript=new pt(50)}var Bt=(Pt.prototype.fixedUpdate=function(t){this._playerPassedObstacleScript.fixedUpdate(t),t.x+t._aabb.x1<ht._worldRight&&(t.x+=-1),t.x+t._aabb.x2<ht._worldLeft&&this._recycle(t)},Pt.prototype._recycle=function(t){this._playerPassedObstacleScript.reset(),t.setActive(!1)},Pt);function Pt(t){for(var i=_t._map._animationsByType.railCart1,e=t.addSprite(_t._texturesById[i[0]._id]),s=0;s<i.length;s++){var a=i[s];e.addAnimationFrame(_t._texturesById[a._id],a._duration)}this._playerPassedObstacleScript=new pt(20),t.tag=ie.RailCart1,t.setActive(!1);var o=t.addCollider(36,20);o.collisionEdgeTop=!1,o.collisionEdgeLeft=!1,o.collisionEdgeRight=!1,o.collisionEdgeBottom=!1,o.offsetX=-2,o.offsetY=14,o.type=k.Dynamic}var Ct=(kt.prototype.fixedUpdate=function(t){this._playerPassedObstacleScript.fixedUpdate(t),t.x+t._aabb.x1<ht._worldRight&&(t.x+=-1),t.x+t._aabb.x2<ht._worldLeft&&this._recycle(t)},kt.prototype._recycle=function(t){this._playerPassedObstacleScript.reset(),t.setActive(!1)},kt);function kt(t){for(var i=_t._map._animationsByType.railCart2,e=t.addSprite(_t._texturesById[i[0]._id]),s=0;s<i.length;s++){var a=i[s];e.addAnimationFrame(_t._texturesById[a._id],a._duration)}this._playerPassedObstacleScript=new pt(40),t.tag=ie.RailCart2,t.setActive(!1);var o=t.addCollider(46,24);o.collisionEdgeTop=!1,o.collisionEdgeLeft=!1,o.collisionEdgeRight=!1,o.collisionEdgeBottom=!1,o.offsetX=-3,o.offsetY=20,o.type=k.Dynamic}var Ut=(Rt.prototype.fixedUpdate=function(t){switch(this._sprite._currentFrame){case 0:this._collider.active=!0,this._collider.offsetY=-30;break;case 3:this._collider.offsetY=-26;break;case 4:this._collider.offsetY=-24;break;case 5:this._collider.offsetY=-20;break;case 6:this._collider.offsetY=-13;break;case 7:this._collider.offsetY=-5;break;case 8:this._collider.offsetY=5;break;case 9:this._collider.offsetY=20;break;case 10:this._collider.offsetY=46;break;case 13:this._collider.active=!1}},Rt);function Rt(){this._entity=lt.createEntity(0,0,$i.PropsFront),this._entity.tag=ie.SlimeDrip,(this._entity.fixedUpdate=this)._collider=this._entity.addCollider(5,5),this._collider.offsetX=-13,this._collider.offsetY=-30,this._collider.collisionEdgeTop=!1,this._collider.collisionEdgeLeft=!1,this._collider.collisionEdgeRight=!1,this._collider.collisionEdgeBottom=!1,this._collider.tagFilter=ie.PlayerProjectile,this._sprite=_t.addSpriteFromAnimation(this._entity,"slimeDropperDrip")}var Xt=(Yt.prototype.fixedUpdate=function(t){this._playerPassedObstacleScript.fixedUpdate(t);for(var i=0;i<this._collider._hitCount;i++){var e=this._collider._hits[i];e._entity.tag!=ie.PlayerProjectile&&e._entity.tag!=ie.Player||(e._entity.tag==ie.PlayerProjectile&&dt.addToScore(10,t.x,t.y),I.playSound("assets/Audio/explosion1.ogg"),this._entity.setActive(!1))}t.x<ht._x-nt._centerX&&this._entity.setActive(!0)},Yt);function Yt(){this._entity=lt.createEntity(0,0,$i.Characters),this._entity.tag=ie.RailStopSign,this._entity.setActive(!1),this._mainSprite=this._entity.addSprite(_t._texturesByType.railStopSign[0]),this._playerPassedObstacleScript=new pt(20);var t=this._entity.addCollider(24,22);t.collisionEdgeTop=!1,t.collisionEdgeLeft=!1,t.collisionEdgeRight=!1,t.collisionEdgeBottom=!1,t.offsetX=-4,t.offsetY=4,this._collider=t,this._entity.fixedUpdate=this}var Lt=(Mt.prototype.fixedUpdate=function(){0<this._collider._hitCount&&this._collider._hits[0]._entity.tag==ie.Player&&(this._collider.active=!1,this._collider.reset(),this._activeGateDelay=rt._fixedUpdateCount+25,this._hidePlayerDelay=rt._fixedUpdateCount+40),-1!=this._activeGateDelay&&this._activeGateDelay<rt._fixedUpdateCount&&(this._sprite.active=!0,this._sprite.playAnimation(),this._activeGateDelay=-1),-1!=this._hidePlayerDelay&&this._hidePlayerDelay<rt._fixedUpdateCount&&(dt.triggerTeleportAway(),I.playSound("assets/Audio/teleport1.ogg"),this._hidePlayerDelay=-1)},Mt);function Mt(){var t=this;this._entity=lt.createEntity(0,0,$i.PropsFront),this._entity.tag=ie.EndGate,this._sprite=_t.addSpriteFromAnimation(this._entity,"endGateActive"),this._sprite.animationFinishedCallback=function(){t._sprite.active=!1},this._sprite.repeatAnimation(!1),this._sprite.active=!1,this._collider=this._entity.addCollider(24,81),this._collider.offsetX=-12,this._collider.offsetY=23,(this._entity.fixedUpdate=this)._hidePlayerDelay=-1,this._activeGateDelay=-1}var Ot=(It.init=function(){this._slimeTraps1=new z,this._tunnelTraps=new z,this._groundTurrets1=new z,this._fireTraps1=new z,this._poisonTraps1=new z,this._explosionTraps1=new z,this._railTurrets1=new z,this._railCarts1=new z,this._railCarts2=new z,this._slimeDropperDrip=new z;for(var t=0;t<6;t++){(i=lt.createEntity(ht._x+nt._centerX,0,$i.Characters)).fixedUpdate=new gt(i),this._slimeTraps1.addToPool(i)}for(var i,t=0;t<5;t++){(i=lt.createEntity(ht._x+nt._centerX,0,$i.Characters)).fixedUpdate=new yt(i),this._tunnelTraps.addToPool(i)}for(t=0;t<10;t++){var e=lt.createEntity(0,0,$i.Characters);e.fixedUpdate=new Ci(e),this._groundTurrets1.addToPool(e)}for(t=0;t<10;t++){var s=lt.createEntity(0,0,$i.Platforms);s.fixedUpdate=new vt(s),this._fireTraps1.addToPool(s)}for(t=0;t<10;t++){var a=lt.createEntity(0,0,$i.Characters);a.fixedUpdate=new Tt(a),this._poisonTraps1.addToPool(a)}for(t=0;t<10;t++){var o=lt.createEntity(0,0,$i.Characters);o.fixedUpdate=new Et(o),this._railTurrets1.addToPool(o)}for(t=0;t<10;t++){var r=lt.createEntity(0,0,$i.Characters);r.fixedUpdate=new Bt(r),this._railCarts1.addToPool(r)}for(t=0;t<10;t++){var n=lt.createEntity(0,0,$i.Characters);n.fixedUpdate=new Ct(n),this._railCarts2.addToPool(n)}for(t=0;t<10;t++){var h=lt.createEntity(0,0,$i.Characters);h.fixedUpdate=new wt(h),this._explosionTraps1.addToPool(h)}for(t=0;t<10;t++)this._slimeDropperDrip.addToPool((new Ut)._entity)},It.fixedUpdate=function(){},It);function It(){}var Ht=(Wt.init=function(){var t=lt.createEntity(0,nt._centerY-16,$i.Sky),i=new m("assets/backgrounds/AssetBG.png");t.addSprite(i),t.setScale(160,1),this._twilight=t;var e=lt.createEntity(0,nt._centerY-16,$i.ParallaxFar),s=new m("assets/backgrounds/AssetCityBG.png");e.addSprite(s),e.parallax=new v(.5),this._buildingsFar=e;var a=lt.createEntity(0,nt._centerY-16,$i.ParallaxFar),o=new m("assets/backgrounds/Fog_Back.png");a.addSprite(o),this._fogFar=a,this._fogFar.colorTintG=1.5;var r=lt.createEntity(0,nt._centerY+76,$i.ParallaxNear),n=new m("assets/backgrounds/AssetBG.png",2,16);n.colorTintR=.1,n.colorTintG=.1,n.colorTintB=.1,r.addSprite(n),r.setScale(160,1),this._buildingsBackGround=r;var h=lt.createEntity(0,nt._centerY-16,$i.ParallaxNear),_=new m("assets/backgrounds/Assetbgbuilding01.png");h.addSprite(_);var l=new m("assets/backgrounds/Assetbgbuilding02.png");h.addSprite(l,180);var d=new m("assets/backgrounds/Assetbgbuilding03.png");h.addSprite(d,-180,73);var c=new m("assets/backgrounds/Assetbgbuilding04.png");h.addSprite(c,-360);var p=new m("assets/backgrounds/Assetbgbuilding05.png");h.addSprite(p,360),h.parallax=new v(.25,0,16),this._buildingsBack=h;var u=lt.createEntity(0,nt._centerY-16,$i.ParallaxNear),g=new m("assets/backgrounds/Fog_front.png");u.addSprite(g),this._fogBack=u,this._fogBack.colorTintG=1.5;var f=lt.createEntity(0,nt._centerY-16,$i.PropsBehindFade),y=new m("assets/backgrounds/Fog_front.png");f.addSprite(y),this._fogFront=f,this._fogFront.colorTintG=1.5,this.fadeOutBuildingsBack=!1,this.fadeInBuildingsBack=!1,this.fadeOutFogFront=!1,this.fadeInFogFront=!1,this.fadeInFogFrontDelay=0},Wt.fixedUpdate=function(){var t=Xi._currentOffsetY+nt._centerY-16,i=Math.ceil(.8*Xi._currentOffsetY)+nt._centerY-16;this._twilight.x=ht._x,this._twilight.y=t,this._buildingsFar.y=i,this._fogFar.x=ht._x,this._fogFar.y=t,this._buildingsBackGround.x=ht._x,this._fogBack.x=ht._x,this._fogBack.y=t,this._fogFront.x=ht._x,this._fogFront.y=t,this.fadeOutBuildingsBack&&0<this._buildingsBack.colorTintA?this._buildingsBack.colorTintA-=.001:this.fadeOutBuildingsBack&&(this._buildingsBack.colorTintA=0,this.fadeOutBuildingsBack=!1),this.fadeInBuildingsBack&&this._buildingsBack.colorTintA<1?this._buildingsBack.colorTintA+=.01:this.fadeInBuildingsBack&&(this._buildingsBack.colorTintA=1,this.fadeInBuildingsBack=!1),this.fadeOutFogFront&&0<this._fogFront.colorTintA?this._fogFront.colorTintA-=.005:this.fadeOutFogFront&&(this._fogFront.colorTintA=0,this.fadeOutFogFront=!1),this.fadeInFogFrontDelay<rt._lastUpdateTime&&(this.fadeInFogFront&&this._fogFront.colorTintA<1?this._fogFront.colorTintA+=.01:this.fadeInFogFront&&(this._fogFront.colorTintA=1,this.fadeInFogFront=!1))},Wt);function Wt(){}var jt=(zt.prototype.fixedUpdate=function(t){for(var i=t._colliders[0],e=0;e<i._hitCount;e++){i._hits[e]._entity.tag==ie.HitTester&&(this._isOn=!this._isOn,this._setToggle())}},zt.prototype._setToggle=function(){this._sprite.setTexture(this._isOn?this._textureOn:this._textureOff);var t=this._isOn?1:0;N.save("sfx-volume",t.toString()),nt._isVisible&&(0==t?postMessage([V.MuteSound]):postMessage([V.UnmuteSound]))},zt);function zt(){var t=lt.createEntity(nt._width-16,16,$i.UIBehind);t.ui=!0,t.tag=ie.AudioToggle,(t.fixedUpdate=this)._textureOn=new m("assets/interface/Sound_on.png"),this._textureOff=new m("assets/interface/Sound_off.png");var i=N.load("sfx-volume"),e=i?parseFloat(i):1;this._isOn=1==e,this._changedThisUpdate=!1,this._sprite=t.addSprite(this._textureOff);var s=t.addCollider(25,25);s.collisionEdgeTop=!1,s.collisionEdgeLeft=!1,s.collisionEdgeRight=!1,s.collisionEdgeBottom=!1,this._setToggle()}var Gt=(Nt.prototype.fixedUpdate=function(t){for(var i=t._colliders[0],e=0;e<i._hitCount;e++){i._hits[e]._entity.tag==ie.HitTester&&(this._isOn=!this._isOn,this._setToggle())}},Nt.prototype._setToggle=function(){this._sprite.setTexture(this._isOn?this._textureOn:this._textureOff);var t=this._isOn?1:0;N.save("music-volume",t.toString()),nt._isVisible&&(0==t?postMessage([V.MuteMusic]):postMessage([V.UnmuteMusic]))},Nt);function Nt(){var t=lt.createEntity(nt._width-46,16,$i.UIBehind);t.ui=!0,t.tag=ie.AudioToggle,(t.fixedUpdate=this)._textureOn=new m("assets/interface/music.png"),this._textureOff=new m("assets/interface/music-off.png");var i=N.load("music-volume"),e=i?parseFloat(i):1;this._isOn=1==e,this._changedThisUpdate=!1,this._sprite=t.addSprite(this._textureOff);var s=t.addCollider(25,25);s.collisionEdgeTop=!1,s.collisionEdgeLeft=!1,s.collisionEdgeRight=!1,s.collisionEdgeBottom=!1,this._setToggle()}var Jt=(Vt.prototype.init=function(t,i,e){this._timeToDie=rt._fixedUpdateCount+40,this._velocityY=-3,this._entity.x=i,this._entity.y=e,this._entity.setText(t,Zt._scoreFont)},Vt.prototype.fixedUpdate=function(){this._entity.x+=1,this._entity.y+=this._velocityY,rt._fixedUpdateCount%4==0&&(this._velocityY+=1),this._timeToDie<rt._fixedUpdateCount&&this._entity.setActive(!1)},Vt);function Vt(){this._entity=lt.createEntity(0,0,$i.Foreground),this._entity.setText("777",Zt._scoreFont),this._entity.setActive(!1),(this._entity.fixedUpdate=this)._timeToDie=0,this._velocityY=0,this._velocityX=0}var Kt=(qt.init=function(){this._startDelay=_e._spectator?60:200,this._startTime=-1,this._restartDelay=rt._fixedUpdateCount+20,this._countDownNumber=3,this._countDownSegment=this._startDelay/4,this._instructions=lt.createEntity(nt._centerX,nt._centerY-45,$i.UIBehind),this._tutorialSprite=this._instructions.addSprite(new m("assets/interface/instructions.png")),this._center=lt.createEntity(nt._centerX,nt._centerY,$i.UIFront),this._center.tag=ie.StartTrigger,this._center.ui=!0,this._playReplayCollider=this._center.addCollider(166,110),this._playReplayCollider.collisionEdgeTop=!1,this._playReplayCollider.collisionEdgeLeft=!1,this._playReplayCollider.collisionEdgeRight=!1,this._playReplayCollider.collisionEdgeBottom=!1,this._replaySprite=this._center.addSprite(new m("assets/interface/replay01.png",38,38)),this._replaySprite.setAnimationX(8,4),this._replaySprite.active=!1,this._countdownTextBgSprite=this._center.addSprite(new m("assets/interface/CountDown.png"),-1),this._countdownTextBgSprite.active=!1,this._countdownText=lt.createEntity(nt._centerX,nt._centerY+2,$i.UIFront),this._countdownText.setText(""),this._countdownText.ui=!0,this._countdownText.colorTintR=0,this._countdownText.colorTintG=0,this._countdownText.colorTintB=0,I.playMusic("assets/Audio/music1.ogg")},qt.fixedUpdate=function(){for(var t=0;t<this._playReplayCollider._hitCount;t++){this._playReplayCollider._hits[t]._entity.tag==ie.HitTester&&this.startButtonPressed()}if(this._screenshotButton)for(t=0;t<this._screenshotButtonCollider._hitCount;t++){this._screenshotButtonCollider._hits[t]._entity.tag==ie.HitTester&&postMessage([e.RequestToScreenshot])}if((se._startDown&&this.startButtonPressed(),-1!=this._startTime)&&((this._startTime-rt._fixedUpdateCount)%this._countDownSegment==0&&-1<this._countDownNumber)){if(0==this._countDownNumber)return this._startTime=-1,this._countdownTextBgSprite.active=!1,this._center.setActive(!1),this._countdownText.setActive(!1),void dt.triggerBeginRun();var i=0==this._countDownNumber?"":this._countDownNumber.toString();0!=this._countDownNumber&&I.playSound("assets/Audio/beep1.ogg"),this._countdownTextBgSprite.active=!0,this._countdownText.setText(i),this._countDownNumber--}},qt.startButtonPressed=function(){rt._fixedUpdateCount>this._restartDelay&&(this._replaySprite.active?(I.stopMusic("assets/Audio/music1.ogg"),lt.shutDown(),_e.init(Zi.Main)):3==this._countDownNumber&&this.startCountdown())},qt.startCountdown=function(){this._startTime=rt._fixedUpdateCount+this._startDelay,this._playReplayCollider.active=!1,this._playReplayCollider.reset()},qt.activateReplayButton=function(){this._restartDelay=rt._fixedUpdateCount+20,this._center.setActive(!0),this._replaySprite.active=!0,this._playReplayCollider.set(50,50),this._playReplayCollider.active=!0,this._screenshotButton&&this._screenshotButton.setActive(!0)},qt.enableScreenshotButtonOnGameOver=function(){this._screenshotButton=lt.createEntity(nt._centerX,nt._centerY+40,$i.UIFront),this._screenshotButton.ui=!0,this._screenshotButton.tag=ie.ScreenShotButton,this._screenshotButton.addSprite(new m("assets/interface/camera-icon.png",32,22)),this._screenshotButtonCollider=this._screenshotButton.addCollider(34,24),this._screenshotButton.setActive(!1)},qt);function qt(){}var Zt=(Qt.init=function(){Kt.init(),this._lives=[],this._scoreFont=new D("assets/interface/Vivaldia_numbers.png",5,9,-80);var t=lt.createEntity(nt._centerX,19,$i.UIBehind);t.ui=!0,t.addSprite(new m("assets/interface/Score_plate.png",92,38));var i=lt.createEntity(nt._centerX,14,$i.UIBehind);i.setText(""),i.ui=!0,this._scoreText=i;var e=new m("assets/interface/star1.png"),s=lt.createEntity(nt._centerX,26,$i.UIBehind);s.colorTintG=.75,s.colorTintB=0,s.setText(dt._lastHighScore.toString(),this._scoreFont),s.ui=!0,this._highScoreText=s,this._highScoreStarLeft=s.addSprite(e,this._highScoreText._aabb.x1-9,-1),this._highScoreStarRight=s.addSprite(e,this._highScoreText._aabb.x2+8,-1);var a=lt.createEntity(32,14,$i.UIBehind);a.ui=!0,a.addSprite(new m("assets/interface/Life_status.png",54,22));for(var o=new m("assets/interface/Life_status.png",9,8,8,29),r=0;r<3;r++){var n=lt.createEntity(18+14*r,14,$i.UIBehind);n.ui=!0,n.addSprite(o),this._lives.push(n)}this._scoreIndicators=new z;for(r=0;r<16;r++)this._scoreIndicators.addToPool((new Jt)._entity);Qt.setScore(dt._score),Qt.setLives(dt._lives)},Qt.fixedUpdate=function(){Kt.fixedUpdate()},Qt.setScore=function(t){this._scoreText.setText(t.toString(),this._scoreFont)},Qt.setLives=function(t){for(var i=0;i<3;i++)this._lives[i].setActive(i<t)},Qt.gameOver=function(){Kt.activateReplayButton(),dt._lastHighScore<dt._score&&N.save(_e._highScoreKey,dt._score.toString())},Qt);function Qt(){}var $t=(ti.prototype.fixedUpdate=function(t){switch(this._state){case Bi.Default:var i;t.x+=this.speedX,t.y+=this.speedY,0<this._collider._hitCount&&((i=this._collider._hits[0]._entity).tag!=ie.PickupHeart&&i.tag!=ie.PickupCoin&&(this._state=Bi.Hit,this._recycleTime=rt._fixedUpdateCount+24,this._mainSprite.active=!1,this._hitSprite.active=!0,this._hitSprite.setAnimationX(4,5,!1),this._collider.active=!1,this._collider.reset(),I.playSound("assets/Audio/hit1.ogg"))),(t.x>ht._x+nt._centerX||t.x<ht._x-nt._centerX||t.y>ht._y+nt._centerY||t.y<ht._y-nt._centerY)&&this._destroy(t);break;case Bi.Hit:0<this._recycleTime&&this._recycleTime<rt._fixedUpdateCount&&this._destroy(t)}},ti.prototype._destroy=function(t){this._recycleTime=0,this._mainSprite.resetAnimationX(),this._hitSprite.resetAnimationX(),this._collider.active=!0,this._hitSprite.active=!1,this._mainSprite.active=!0,this._state=Bi.Default,t.setActive(!1)},ti);function ti(t,i,e){void 0===i&&(i=0),void 0===e&&(e=4);var s=_t._texturesById[_t._map._animationsByType.flyingDrone1MuzzleFlash[3]._id],a=_t._texturesById[_t._map._animationsByType.drone1ProjectileHit[0]._id];this._mainSprite=t.addSprite(s),this._hitSprite=t.addSprite(a,0,-18),this._hitSprite.active=!1,this._collider=t.addCollider(8,8),t.tag=ie.Drone1Projectile,this._collider.tagFilter=ie.FlyingDrone1,this._collider.collisionEdgeTop=!1,this._collider.collisionEdgeLeft=!1,this._collider.collisionEdgeRight=!1,this._collider.collisionEdgeBottom=!1,this._collider.type=k.Dynamic,this.speedX=i,this.speedY=e,this._recycleTime=0,this._state=Bi.Default,t.setActive(!1)}var ii=(ei.prototype.fixedUpdate=function(t){switch(this._state){case Bi.Default:t.x+=this.speedX,t.y+=this.speedY;for(var i,e,s=0,a=null,o=!1,r=0;r<this._collider._hitCount;r++){var n=this._collider._hits[r],h=n._entity;h.tag==ie.MapChunk&&(a=n,s++),h.tag!=ie.PickupHeart&&h.tag!=ie.PickupCoin&&(o=!0)}2!=s&&1!=s||(i=null==a?void 0:a._entity.fixedUpdate,e=null,1==s?e=_i._destroyedConcreteTiles1.getAvailableEntity():2==s&&(e=_i._destroyedConcreteTiles2.getAvailableEntity()),e&&a&&(e._sprites[0].playAnimation(),e.x=a._entity.x+a.offsetX,e.y=a._entity.y+a.offsetY,i.addToExtras(e))),o&&(this._state=Bi.Hit,this._recycleTime=rt._fixedUpdateCount+24,this._mainSprite.active=!1,this._hitSprite.active=!0,this._hitSprite.setAnimationX(4,3,!1),this._collider.active=!1,this._collider.reset(),0==s?I.playSound("assets/Audio/hit1.ogg"):I.playSound("assets/Audio/explosion1.ogg")),(t.x>ht._x+nt._centerX||t.x<ht._x-nt._centerX||t.y>ht._y+nt._centerY||t.y<ht._y-nt._centerY)&&this._destroy(t);break;case Bi.Hit:0<this._recycleTime&&this._recycleTime<rt._fixedUpdateCount&&this._destroy(t)}},ei.prototype._destroy=function(t){this._recycleTime=0,this._mainSprite.resetAnimationX(),this._hitSprite.resetAnimationX(),this._collider.active=!0,this._hitSprite.active=!1,this._mainSprite.active=!0,this._state=Bi.Default,t.setActive(!1)},ei);function ei(t){var i=_t._texturesById[_t._map._animationsByType.drone2Projectile[3]._id],e=_t._texturesById[_t._map._animationsByType.drone2ProjectileHit[0]._id];this._mainSprite=t.addSprite(i,2,-13),this._hitSprite=t.addSprite(e,0,-18),this._hitSprite.active=!1,this._collider=t.addCollider(8,8),t.tag=ie.Drone2Projectile,this._collider.tagFilter=ie.FlyingDrone2,this._collider.collisionEdgeTop=!1,this._collider.collisionEdgeLeft=!1,this._collider.collisionEdgeRight=!1,this._collider.collisionEdgeBottom=!1,this._collider.type=k.Dynamic,this.speedX=0,this.speedY=4,this._recycleTime=0,this._state=Bi.Default;for(var s=_t._map._animationsByType.drone2Projectile,a=0;a<s.length;a++){var o=s[a];this._mainSprite.addAnimationFrame(_t._texturesById[o._id],o._duration)}t.setActive(!1)}var si,ai,oi=(ri.prototype.fixedUpdate=function(t){switch(this._state){case Bi.Default:var i;t.x+=this.speedX,t.y+=this.speedY,0<this._collider._hitCount&&((i=this._collider._hits[0]._entity).tag!=ie.PickupHeart&&i.tag!=ie.PickupCoin&&(this._state=Bi.Hit,this._recycleTime=rt._fixedUpdateCount+24,this._mainSprite.active=!1,this._hitSprite.active=!0,this._hitSprite.setAnimationX(4,3,!1),this._collider.active=!1,this._collider.reset(),I.playSound("assets/Audio/hit1.ogg"))),(t.x>ht._x+nt._centerX||t.x<ht._x-nt._centerX||t.y>ht._y+nt._centerY||t.y<ht._y-nt._centerY)&&this._destroy(t);break;case Bi.Hit:0<this._recycleTime&&this._recycleTime<rt._fixedUpdateCount&&this._destroy(t)}},ri.prototype._destroy=function(t){this._recycleTime=0,this._mainSprite.resetAnimationX(),this._hitSprite.resetAnimationX(),this._collider.active=!0,this._hitSprite.active=!1,this._mainSprite.active=!0,this._state=Bi.Default,t.setActive(!1)},ri);function ri(t){var i=_t._texturesById[_t._map._animationsByType.flyingDrone4ProjectileHit[0]._id],e=_t._texturesById[_t._map._animationsByType.flyingDrone4ProjectileHit[0]._id];this._mainSprite=t.addSprite(i,35,-20),this._mainSprite.repeatAnimation(!1),this._hitSprite=t.addSprite(e,25,-16),this._hitSprite.active=!1,this._collider=t.addCollider(8,8),t.tag=ie.Drone4Projectile,this._collider.tagFilter=ie.FlyingDrone4,this._collider.collisionEdgeTop=!1,this._collider.collisionEdgeLeft=!1,this._collider.collisionEdgeRight=!1,this._collider.collisionEdgeBottom=!1,this._collider.offsetX=8,this._collider.offsetY=8,this._collider.type=k.Dynamic,this.speedX=-4,this.speedY=4,this._recycleTime=0,this._state=Bi.Default,t.setActive(!1)}(ai=si=si||{})[ai.Up=0]="Up",ai[ai.Deg45=1]="Deg45",ai[ai.Deg45Reverse=2]="Deg45Reverse",ai[ai.Forward=3]="Forward";var ni=(hi.prototype.init=function(t,i,e){this._entity.x=t,this._entity.y=i,this._collider.active=!0,I.playSound("assets/Audio/shoot1.ogg"),this._spriteHit.active=!1,this._setDirection(e)},hi.prototype._setDirection=function(t){switch(t){case si.Up:this._spriteUp.active=!0,this._spriteDeg45.active=!1,this._spriteForward.active=!1,this.speedX=0,this.speedY=-4;break;case si.Deg45:this._spriteUp.active=!1,this._spriteDeg45.active=!0,this._spriteForward.active=!1,this.speedX=4,this.speedY=-4;break;case si.Deg45Reverse:this._spriteUp.active=!0,this._spriteDeg45.active=!1,this._spriteForward.active=!1,this.speedX=-4,this.speedY=-4;break;case si.Forward:this._spriteUp.active=!1,this._spriteDeg45.active=!1,this._spriteForward.active=!0,this.speedX=4,this.speedY=0}},hi.prototype.fixedUpdate=function(t){if(!this._spriteHit.active){var i=dt._playerState==Q.Start?0:dt._forwardSpeed;if(t.x+=i+this.speedX,t.y+=this.speedY,(t.x>ht._x+nt._centerX||t.y<ht._y-nt._centerY)&&this._entity.setActive(!1),0<t._sprites.length&&this._collider.active&&0<this._collider._hitCount){var e=!1;switch(this._collider._hits[0]._entity.tag){case ie.Drone1Projectile:dt.addToScore(5,t.x,t.y);break;case ie.Drone2Projectile:dt.addToScore(10,t.x,t.y);break;case ie.Drone4Projectile:dt.addToScore(15,t.x,t.y);break;case ie.GroundTurret1:case ie.RailCart1:case ie.RailCart2:case ie.RailTurret1:e=!0}e?(this._entity.x-=20,this._entity.y-=20,this._setDirection(si.Deg45Reverse),I.playSound("assets/Audio/deflect1.ogg")):(this._collider.active=!1,this._spriteDeg45.active=!1,this._spriteUp.active=!1,this._spriteForward.active=!1,this._spriteHit.active=!0,this._spriteHit.playAnimation(),I.playSound("assets/Audio/hit1.ogg"))}}},hi);function hi(){var t=this;this._entity=lt.createEntity(0,0,$i.Characters),this._entity.tag=ie.PlayerProjectile,this._spriteUp=_t.addSpriteFromAnimation(this._entity,"playerProjectileUp"),this._spriteDeg45=_t.addSpriteFromAnimation(this._entity,"playerProjectile45deg"),this._spriteForward=_t.addSpriteFromAnimation(this._entity,"playerProjectileForward"),this._spriteHit=_t.addSpriteFromAnimation(this._entity,"playerProjectileHit"),this._spriteHit.repeatAnimation(!1),this._spriteHit.animationFinishedCallback=function(){t._entity.setActive(!1)},this._collider=this._entity.addCollider(6,6),this._collider.tagFilter=ie.Player,this._collider.collisionEdgeTop=!1,this._collider.collisionEdgeLeft=!1,this._collider.collisionEdgeRight=!1,this._collider.collisionEdgeBottom=!1,this._collider.type=k.Dynamic,this._entity.fixedUpdate=this}var _i=(li.init=function(){this._playerProjectiles=new z,this._drone1projectilesLeft=new z,this._drone1projectilesRight=new z,this._drone2projectiles=new z,this._drone4projectiles=new z,this._turret1Projectile=new z,this._destroyedConcreteTiles1=new z,this._destroyedConcreteTiles2=new z;for(var t=0;t<10;t++)this._playerProjectiles.addToPool((new ni)._entity);for(t=0;t<10;t++){(i=lt.createEntity(0,0,$i.Characters)).fixedUpdate=new $t(i,3),this._drone1projectilesLeft.addToPool(i)}for(t=0;t<10;t++){(i=lt.createEntity(0,0,$i.Characters)).fixedUpdate=new $t(i,-1),this._drone1projectilesRight.addToPool(i)}for(t=0;t<10;t++){(i=lt.createEntity(0,0,$i.Characters)).fixedUpdate=new ii(i),this._drone2projectiles.addToPool(i)}for(t=0;t<10;t++){(i=lt.createEntity(0,0,$i.PropsFront)).fixedUpdate=new oi(i),this._drone4projectiles.addToPool(i)}for(var i,t=0;t<10;t++){(i=lt.createEntity(0,0,$i.Characters)).fixedUpdate=new Dt(i),this._turret1Projectile.addToPool(i)}for(t=0;t<12;t++){var e=lt.createEntity(0,0,$i.Platforms);(s=_t.addSpriteFromAnimation(e,"destroyConcreteGround1")).drawOffsetX=0,s.drawOffsetY=-16,s.repeatAnimation(!1),this._destroyedConcreteTiles1.addToPool(e)}for(t=0;t<12;t++){var s,a=lt.createEntity(0,0,$i.Platforms);(s=_t.addSpriteFromAnimation(a,"destroyConcreteGround2")).drawOffsetX=-8,s.drawOffsetY=-24,s.repeatAnimation(!1),this._destroyedConcreteTiles2.addToPool(a)}},li.fixedUpdate=function(){},li);function li(){}var di=(ci.prototype.init=function(t,i){this._entity.x=t,this._entity.y=i,this._state=Bi.Default,this._projectileLauncher.reset(),this._takesDamage.reset(),this._spawned=!1,this._entity._colliders[0].active=!1,this._mainSprite.active=!1,this._deathSprite.active=!1},ci.prototype.fixedUpdate=function(t){if(this._spawned)switch(t.x+=this._speed,this._state){case Bi.Default:this._takesDamage.fixedUpdate(),t.x>ht._x-nt._centerX&&this._projectileLauncher.fixedUpdate(t),this._takesDamage._hitPoints<=0&&(this._state=Bi.Dying,dt.addToScore(20,t.x,t.y),this._projectileLauncher.cancelLaunchingProjectile=!0,this._muzzleFlash.active=!1,this._mainSprite.active=!1,this._deathSprite.active=!0,this._deathSprite.playAnimation(),I.playSound("assets/Audio/explosion1.ogg")),this._spawnedRight&&this._entity.x+this._entity._aabb.x2<ht._worldLeft&&this._entity.setActive(!1),!this._spawnedRight&&this._entity.x+this._entity._aabb.x1>ht._worldRight&&this._entity.setActive(!1);break;case Bi.Dying:}else(this._spawnedRight&&this._entity.x+this._entity._aabb.x1<ht._worldRight||!this._spawnedRight&&this._entity.x+this._entity._aabb.x2<ht._worldLeft)&&(this._spawned=!0,t._sprites[0].active=!0,t._colliders[0].active=!0)},ci);function ci(t){void 0===t&&(t=!1);var i=this;this._entity=lt.createEntity(0,0,$i.Characters),this._entity.tag=ie.FlyingDrone1;var e=_t._map._animationsByType.flyingDrone1Idle,s=_t._texturesById[e[0]._id];this._mainSprite=this._entity.addSprite(s,0,0);for(var a=0;a<e.length;a++){var o=e[a];_t._texturesById[o._id]._drawWidth=32,this._mainSprite.addAnimationFrame(_t._texturesById[o._id],o._duration)}this._deathSprite=_t.addSpriteFromAnimation(this._entity,"flyingDrone1Death"),this._deathSprite.drawOffsetX=-5,this._deathSprite.drawOffsetY=2,this._deathSprite.active=!1,this._deathSprite.repeatAnimation(!1),this._deathSprite.animationFinishedCallback=function(){return i._entity.setActive(!1)},this._spawnedRight=t,this._state=Bi.Default,this._speed=t?-1:3,this._muzzleFlash=_t.addSpriteFromAnimation(this._entity,"flyingDrone1MuzzleFlash"),this._muzzleFlash.drawOffsetX=-17,this._muzzleFlash.drawOffsetY=38,this._projectileLauncher=new Ei(t?_i._drone1projectilesRight:_i._drone1projectilesLeft,60,"assets/Audio/shoot2.ogg",-17,38,this._muzzleFlash,!0);var r=this._entity.addCollider(30,42);r.collisionEdgeTop=!1,r.collisionEdgeLeft=!1,r.collisionEdgeRight=!1,r.collisionEdgeBottom=!1,r.offsetX=-17,r.offsetY=10,r.type=k.Dynamic,this._takesDamage=new Ti(r,1),(this._entity.fixedUpdate=this).init(0,0)}var pi=(ui.prototype.init=function(t,i){this._entity.x=t,this._entity.y=i,this._state=Bi.Default,this._takesDamage.reset(),this._projectileLauncher.reset(),this._mainSprite.active=!0,this._deathSprite.active=!1},ui.prototype.fixedUpdate=function(t){switch(this._entity.x+this._entity._aabb.x1<ht._worldRight&&--this._entity.x,this._state){case Bi.Default:if(this._takesDamage.fixedUpdate(),t.x<ht._x+nt._centerX&&this._projectileLauncher.fixedUpdate(t),this._takesDamage._hitPoints<=0){this._state=Bi.Dying,this._mainSprite.active=!1,this._deathSprite.active=!0,this._deathSprite.playAnimation(),dt.addToScore(40,t.x,t.y),I.playSound("assets/Audio/explosion1.ogg");break}this._entity.x+this._entity._aabb.x2<ht._worldLeft&&this._entity.setActive(!1);break;case Bi.Dying:}},ui);function ui(){var t=this;this._entity=lt.createEntity(0,0,$i.Characters),this._entity.tag=ie.FlyingDrone2,this._mainSprite=_t.addSpriteFromAnimation(this._entity,"flyingDrone2"),this._deathSprite=_t.addSpriteFromAnimation(this._entity,"flyingDrone2Death"),this._deathSprite.active=!1,this._deathSprite.repeatAnimation(!1),this._deathSprite.animationFinishedCallback=function(){return t._entity.setActive(!1)};var i=this._entity.addCollider(30,24);i.collisionEdgeTop=!1,i.collisionEdgeLeft=!1,i.collisionEdgeRight=!1,i.collisionEdgeBottom=!1,i.offsetX=0,i.offsetY=7,i.type=k.Dynamic,this._projectileLauncher=new Ei(_i._drone2projectiles,60,"assets/Audio/shoot2.ogg",0,36),(this._entity.fixedUpdate=this)._takesDamage=new Ti(i,1)}var gi=(fi.prototype.init=function(t,i){this._entity.x=t,this._entity.y=i,this._state=Bi.Default,this._takesDamage.reset(),this._playerPassedObstacleScript.reset(),this._collider.active=!0,this._mainSprite.active=!0,this._deathSprite.active=!1},fi.prototype.fixedUpdate=function(t){switch(this._entity.x+this._entity._aabb.x1<ht._worldRight&&(this._entity.x-=2),this._state){case Bi.Default:if(this._takesDamage.fixedUpdate(),this._playerPassedObstacleScript.fixedUpdate(t),this._takesDamage._hitPoints<=0){this._state=Bi.Dying,dt.addToScore(20,t.x,t.y),this._collider.active=!1,this._collider.reset(),this._mainSprite.active=!1,this._deathSprite.active=!0,this._deathSprite.playAnimation(),I.playSound("assets/Audio/explosion1.ogg");break}this._entity.x+this._entity._aabb.x2<ht._worldLeft&&this._entity.setActive(!1);break;case Bi.Dying:}},fi);function fi(){var t=this;this._entity=lt.createEntity(0,0,$i.Characters),this._entity.tag=ie.FlyingDrone3,this._mainSprite=_t.addSpriteFromAnimation(this._entity,"flyingDrone3"),this._mainSprite.drawOffsetY=-3,this._deathSprite=_t.addSpriteFromAnimation(this._entity,"flyingDrone3Death"),this._deathSprite.drawOffsetY=-3,this._deathSprite.active=!1,this._deathSprite.repeatAnimation(!1),this._deathSprite.animationFinishedCallback=function(){return t._entity.setActive(!1)},this._playerPassedObstacleScript=new pt(30),this._collider=this._entity.addCollider(36,13),this._collider.collisionEdgeTop=!1,this._collider.collisionEdgeLeft=!1,this._collider.collisionEdgeRight=!1,this._collider.collisionEdgeBottom=!1,this._collider.offsetX=-6,this._collider.offsetY=8,this._collider.type=k.Dynamic,this._takesDamage=new Ti(this._collider,1),(this._entity.fixedUpdate=this).init(0,0)}var yi=(mi.prototype.init=function(t,i){this._entity.x=t,this._entity.y=i,this._state=Bi.Default,this._mainSprite.active=!0,this._deathSprite.active=!1,this._takesDamage.reset(),this._directionX=-1,this._projectileLauncher.reset(),this._hasTouchLeaveCollider=!1},mi.prototype.fixedUpdate=function(t){switch(this._entity.x+this._entity._aabb.x1<ht._worldRight&&(t.x+=dt._forwardSpeed+this._directionX),this._state){case Bi.Default:if(this._takesDamage.fixedUpdate(),t.x<ht._x+nt._centerX&&this._projectileLauncher.fixedUpdate(t),this._takesDamage._hitPoints<=0){this._state=Bi.Dying,this._mainSprite.active=!1,this._deathSprite.active=!0,this._deathSprite.playAnimation(),I.playSound("assets/Audio/explosion1.ogg"),dt.addToScore(60,t.x,t.y);break}for(var i=t._colliders[0],e=0;e<i._hitCount;e++){i._hits[e]._entity.tag==ie.DroneGuardLeft&&(this._hasTouchLeaveCollider=!0)}this._hasTouchLeaveCollider?this._directionX=-3:t.x<ht._x?this._directionX=1:t.x>ht._x+nt._centerX&&(this._directionX=-1),0<t._sprites.length&&t.x<ht._x-nt._centerX-t._sprites[0]._texture._drawWidth&&this._entity.setActive(!1);break;case Bi.Dying:}},mi);function mi(){var t=this;this._entity=lt.createEntity(ht._x+nt._centerX,78,$i.Characters),this._entity.tag=ie.FlyingDrone4,this._state=Bi.Default,this._mainSprite=_t.addSpriteFromAnimation(this._entity,"flyingDrone4");for(var i=_t._map._animationsByType.flyingDrone4Projectile,e=_t._texturesById[i[0]._id],s=this._entity.addSprite(e,0,0),a=0;a<2;a++){var o=i[a];s.addAnimationFrame(_t._texturesById[o._id],o._duration)}this._deathSprite=_t.addSpriteFromAnimation(this._entity,"flyingDrone4Death"),this._deathSprite.drawOffsetY=3,this._deathSprite.active=!1,this._deathSprite.repeatAnimation(!1),this._deathSprite.animationFinishedCallback=function(){return t._entity.setActive(!1)};var r=this._entity.addCollider(32,32);r.collisionEdgeTop=!1,r.collisionEdgeLeft=!1,r.collisionEdgeRight=!1,r.collisionEdgeBottom=!1,r.offsetX=10,r.offsetY=-2,r.type=k.Dynamic,this._projectileLauncher=new Ei(_i._drone4projectiles,60,"assets/Audio/shoot2.ogg",-10,16,s,!0),this._takesDamage=new Ti(r,3),(this._entity.fixedUpdate=this).init(0,0)}var vi=(xi.prototype.init=function(t,i){this._entity.x=t,this._entity.y=i,this._state=Bi.Spawning,this._takesDamage.reset(),this._mainSprite.active=!0,this._deathSprite.active=!1,this._triggeredSprite.active=!1,this._collider.tagFilter=ie.Player,this._collider.active=!0,this._playerPassedObstacleScript.reset(),this._recycleTime=-1},xi.prototype.fixedUpdate=function(t){switch(this._playerPassedObstacleScript.fixedUpdate(this._entity),this._state){case Bi.Spawning:this._entity.x+this._entity._aabb.x1<ht._worldRight&&--this._entity.x,this._entity.x<ht._worldRight-this._mainSprite._texture._halfWidth&&(this._mainSprite.active=!1,this._triggeredSprite.active=!0,this._triggeredSprite.playAnimation(),this._state=Bi.Default);break;case Bi.Default:this._entity.y+=3;for(var i=0;i<this._collider._hitCount;i++){if(this._collider._hits[i]._entity.tag==ie.MapChunk){this._setDying();break}}break;case Bi.Dying:-1!=this._recycleTime&&this._recycleTime<rt._lastUpdateTime&&this._entity.setActive(!1)}},xi.prototype._setDying=function(){this._state=Bi.Dying,this._mainSprite.active=!1,this._triggeredSprite.active=!1,this._collider.tagFilter=ie.PlayerProjectile,this._deathSprite.active=!0,this._deathSprite.playAnimation(),I.playSound("assets/Audio/explosion1.ogg")},xi);function xi(){var t=this;this._entity=lt.createEntity(0,0,$i.Characters),this._entity.tag=ie.FlyingDrone5,(this._entity.fixedUpdate=this)._collider=this._entity.addCollider(33,33),this._collider.offsetX=-10,this._collider.offsetY=10,this._collider.collisionEdgeTop=!1,this._collider.collisionEdgeLeft=!1,this._collider.collisionEdgeRight=!1,this._collider.collisionEdgeBottom=!1,this._collider.type=k.Dynamic,this._mainSprite=_t.addSpriteFromAnimation(this._entity,"flyingDrone5"),this._triggeredSprite=_t.addSpriteFromAnimation(this._entity,"flyingDrone5Triggered"),this._triggeredSprite.repeatAnimation(!1),this._deathSprite=_t.addSpriteFromAnimation(this._entity,"flyingDrone5Explosion"),this._deathSprite.repeatAnimation(!1),this._deathSprite.animationFinishedCallback=function(){t._collider.active=!1,t._recycleTime=rt._lastUpdateTime+500},this._takesDamage=new Ti(this._collider,2),this._playerPassedObstacleScript=new pt(50)}var Ti=(Si.prototype.fixedUpdate=function(){this._hitPointsLastFrame=this._hitPoints;for(var t=0;t<this._hitCollider._hitCount;t++){if(this._hitCollider._hits[t]._entity.tag==ie.PlayerProjectile){this._hitPoints--;break}}},Si.prototype.reset=function(){this._hitPointsLastFrame=this._initalHealth,this._hitPoints=this._initalHealth},Si);function Si(t,i){this._initalHealth=i,this._hitPoints=this._initalHealth,this._hitPointsLastFrame=this._initalHealth,this._hitCollider=t}var wi=(bi.prototype.init=function(t,i){this._entity.x=t,this._entity.y=i,this._playerPassedObstacleScript.reset(),this._state=Bi.Default,this._moveX=-this._speed,this._takesDamage.reset(),this._collider.active=!0,this._rigidBody.active=!0,this._mainSprite.active=!0,this._deathSprite.active=!1,this._futureTrigger=0},bi.prototype.fixedUpdate=function(t){switch(this._state){case Bi.Default:this._playerPassedObstacleScript.fixedUpdate(t),this._takesDamage.fixedUpdate(),this._takesDamage._hitPoints<=0?(this._state=Bi.Dying,this._futureTrigger=rt._fixedUpdateCount+30,this._collider.active=!1,this._rigidBody.active=!1,this._mainSprite.active=!1,this._deathSprite.active=!0,this._deathSprite.playAnimation(),dt.addToScore(20,t.x,t.y),I.playSound("assets/Audio/explosion1.ogg")):this._takesDamage._hitPoints!=this._takesDamage._hitPointsLastFrame&&(this._state=Bi.Hit,this._futureTrigger=rt._fixedUpdateCount+10);for(var i=0;i<this._collider._hitCount;i++){var e=this._collider._hits[i];if(e._entity.tag==ie.DroneGuardRight){this._moveX=this._speed;break}if(e._entity.tag==ie.DroneGuardLeft){this._moveX=-this._speed;break}}t.x+this._entity._aabb.x1<ht._worldRight&&(t.x+=this._moveX),t.x+this._entity._aabb.x2<ht._worldLeft&&this._entity.setActive(!1);break;case Bi.Hit:this._futureTrigger>rt._fixedUpdateCount&&(this._state=Bi.Default);break;case Bi.Dying:}},bi);function bi(){var t=this;this._entity=lt.createEntity(0,0,$i.Characters),this._entity.tag=ie.GroundDrone1,this._mainSprite=_t.addSpriteFromAnimation(this._entity,"groundDrone1"),this._mainSprite.drawOffsetX=22,this._mainSprite.drawOffsetY=-16,this._deathSprite=_t.addSpriteFromAnimation(this._entity,"groundDrone1Death"),this._deathSprite.drawOffsetX=22,this._deathSprite.drawOffsetY=-16,this._deathSprite.active=!1,this._deathSprite.repeatAnimation(!1),this._deathSprite.animationFinishedCallback=function(){return t._entity.setActive(!1)},this._collider=this._entity.addCollider(17,32),this._collider.collisionEdgeTop=!1,this._collider.collisionEdgeLeft=!1,this._collider.collisionEdgeRight=!1,this._collider.collisionEdgeBottom=!0,this._collider.type=k.Dynamic,this._entity.rigidBody=new T,this._rigidBody=this._entity.rigidBody,this._speed=1,this._takesDamage=new Ti(this._collider,1),this._playerPassedObstacleScript=new pt(30),(this._entity.fixedUpdate=this).init(0,0)}var Di=(Ai.prototype.init=function(t,i){this._entity.x=t,this._entity.y=i,this._playerPassedObstacleScript.reset(),this._moveX=-this._speed,this._collider.active=!0,this._rigidBody.active=!0,this._futureTrigger=0},Ai.prototype.fixedUpdate=function(t){this._playerPassedObstacleScript.fixedUpdate(t);for(var i=0;i<this._collider._hitCount;i++){var e=this._collider._hits[i];if(e._entity.tag==ie.DroneGuardRight){this._moveX=this._speed;break}if(e._entity.tag==ie.DroneGuardLeft){this._moveX=-this._speed;break}}t.x+this._entity._aabb.x1<ht._worldRight&&(t.x+=this._moveX),t.x+this._entity._aabb.x2<ht._worldLeft&&this._entity.setActive(!1)},Ai);function Ai(){this._entity=lt.createEntity(0,0,$i.Characters),this._entity.tag=ie.GroundDrone2,this._speed=1,_t.addSpriteFromAnimation(this._entity,"groundDrone2"),this._collider=this._entity.addCollider(24,9),this._collider.collisionEdgeTop=!1,this._collider.collisionEdgeLeft=!1,this._collider.collisionEdgeRight=!1,this._collider.collisionEdgeBottom=!0,this._collider.offsetX=-4,this._collider.offsetY=11,this._collider.type=k.Dynamic,this._entity.rigidBody=new T,this._rigidBody=this._entity.rigidBody,this._playerPassedObstacleScript=new pt(30),(this._entity.fixedUpdate=this).init(0,0)}var Ei=(Fi.prototype.fixedUpdate=function(t){this._parentPositionX=t.x,this._parentPositionY=t.y,this._shotDelay<rt._fixedUpdateCount&&(this._muzzleFlash&&(this._muzzleFlash.active=!0,this._muzzleFlash.playAnimation()),this._shotDelay=rt._fixedUpdateCount+this._shotRepeatRate,this._spawnAfterMuzzleFlash||this._spawnProjectile())},Fi.prototype._spawnProjectile=function(){var t;this.cancelLaunchingProjectile||null!=(t=this._projectilePool.getAvailableEntity())&&(I.playSound(this._shotSound),t.x=this._parentPositionX+this._spawnPosX,t.y=this._parentPositionY+this._spawnPosY)},Fi.prototype._muzzleFlashAnimationFinished=function(){this._muzzleFlash&&(this._muzzleFlash.active=!1),this._spawnAfterMuzzleFlash&&this._spawnProjectile()},Fi.prototype.reset=function(){this.cancelLaunchingProjectile=!1,this._shotDelay=0,this._muzzleFlash&&(this._muzzleFlash.active=!1)},Fi);function Fi(t,i,e,s,a,o,r){void 0===o&&(o=null),void 0===r&&(r=!1),this._projectilePool=t,this._shotRepeatRate=i,this._shotSound=e,this._spawnPosX=s,this._spawnPosY=a,this._muzzleFlash=o,this._spawnAfterMuzzleFlash=r,this._parentPositionX=0,this._parentPositionY=0,this._muzzleFlash&&(this._muzzleFlash.active=!1,this._muzzleFlash.repeatAnimation(!1),this._muzzleFlash.animationFinishedCallback=this._muzzleFlashAnimationFinished.bind(this)),this._shotDelay=0,this.cancelLaunchingProjectile=!1}var Bi,Pi,Ci=(ki.prototype.fixedUpdate=function(t){this._playerPassedObstacleScript.fixedUpdate(t);var i,e=t._sprites[0];this._shot||!this._activated||(i=_i._turret1Projectile.getAvailableEntity())&&(i.x=t.x,i.y=t.y-4,this._shot=!0,I.playSound("assets/Audio/shoot2.ogg")),!this._activated&&t.x<ht._x+nt._centerX&&(this._activated=!0),t.x<ht._x-nt._centerX-e._texture._drawWidth&&this._recycle(t)},ki.prototype._recycle=function(t){t._sprites[0].resetAnimationY(),this._activated=!1,this._shot=!1,this._playerPassedObstacleScript.reset(),t.setActive(!1)},ki);function ki(t){t.tag=ie.GroundTurret1,t.setActive(!1);for(var i=_t._map._animationsByType.groundTurret1,e=t.addSprite(_t._texturesById[i[0]._id],0,0),s=0;s<i.length;s++){var a=i[s];e.addAnimationFrame(_t._texturesById[a._id],a._duration)}var o=t.addCollider(22,20);o.collisionEdgeTop=!1,o.collisionEdgeLeft=!1,o.collisionEdgeRight=!1,o.collisionEdgeBottom=!1,o.offsetX=0,o.offsetY=14,this._state=Bi.Default,this._shot=!1,this._activated=!1,this._playerPassedObstacleScript=new pt(10)}(Pi=Bi=Bi||{})[Pi.Spawning=0]="Spawning",Pi[Pi.Default=1]="Default",Pi[Pi.Hit=2]="Hit",Pi[Pi.Dying=3]="Dying";var Ui=(Ri.init=function(){this._flyingDrones1Left=new z,this._flyingDrones1Right=new z,this._flyingDrones2=new z,this._flyingDrones3=new z,this._flyingDrones4=new z,this._flyingDrones5=new z,this._groundDrones1=new z,this._groundDrones2=new z;for(var t=0;t<10;t++)this._flyingDrones1Left.addToPool((new di)._entity);for(t=0;t<10;t++)this._flyingDrones1Right.addToPool(new di(!0)._entity);for(t=0;t<10;t++)this._flyingDrones2.addToPool((new pi)._entity);for(t=0;t<10;t++)this._flyingDrones3.addToPool((new gi)._entity);for(t=0;t<10;t++)this._flyingDrones4.addToPool((new yi)._entity);for(t=0;t<10;t++)this._flyingDrones5.addToPool((new vi)._entity);for(t=0;t<10;t++)this._groundDrones1.addToPool((new wi)._entity);for(t=0;t<10;t++)this._groundDrones2.addToPool((new Di)._entity)},Ri.fixedUpdate=function(){},Ri);function Ri(){}var Xi=(Yi.init=function(){this._offsetY=0,this._currentOffsetY=0,this._startTransitionAtX=0},Yi.fixedUpdate=function(){this._currentOffsetY!=this._offsetY&&this._startTransitionAtX<=ht._x&&(this._currentOffsetY+=this._currentOffsetY<this._offsetY?1:-1),ht.set(dt._player.x,nt._centerY+this._currentOffsetY-16)},Yi.triggerOffsetY=function(t,i){void 0===i&&(i=0),this._startTransitionAtX=ht._x+i,this._offsetY=t},Yi);function Yi(){}var Li=(Mi.prototype.fixedUpdate=function(t){if(this._transitionChunk&&ht._worldLeft>t.x+t._aabb.getWidth())t.setActive(!1);else for(var i=0;i<t._colliderCount;i++){var e=t._colliders[i];if(e.active&&0<e._hitCount)for(var s=0;s<e._hitCount;s++){var a=e._hits[s];0<e.slope||e.slope<0||a._entity.tag!=ie.Drone2Projectile&&a._entity.tag!=ie.FlyingDrone5||(e.active=!1,t._sprites[i].active=!1)}}},Mi.prototype.addToExtras=function(t){this.extras[this._extrasCount]=t,this._extrasCount++},Mi.prototype.clear=function(){for(var t=0;t<this._extrasCount;t++){this.extras[t].setActive(!1)}this._extrasCount=0},Mi);function Mi(t){void 0===t&&(t=!1),this._transitionChunk=t,this.extras=[],this._extrasCount=0}var Oi=(Ii.init=function(){this._createTileObjectPools(),this._lastChunks={},this._currentChunks={},this._nextChunks={},this._transitionChunkTop={},this._transitionChunkRight={},this._nextJumpX=1,this._drawOffsetY=dt._player.y<0?-12:0,0!=this._drawOffsetY&&(Ht.fadeOutBuildingsBack=!0,Xi.triggerOffsetY(16*this._drawOffsetY));for(var t=0;t<_t._map._objectgroups.length;t++){var i=_t._map._objectgroups[t],e=null;switch(i._name){case"Backgrounds":e=lt.createEntity(0,0,$i.Background);break;case"Foregrounds":e=lt.createEntity(0,0,$i.Foreground)}if(e)for(var s=0;s<i._objects.length;s++){var a=i._objects[s],o=_t._texturesById[a._gid],r=e.addSprite(o);r.drawOffsetX=a._x+o._halfWidth,r.drawOffsetY=a._y-o._halfHeight-8}}this.createEmptyLayers($i.PropsBehind),this.createEmptyLayers($i.Platforms),this.createEmptyLayers($i.PropsFront),this._nextJumpX=Math.ceil(dt._player.x/nt._width),this.spawnChunkInsidePosition(dt._player.x-nt._width,this._drawOffsetY,this._lastChunks),this.spawnChunkInsidePosition(dt._player.x,this._drawOffsetY,this._currentChunks),this.spawnChunkInsidePosition(dt._player.x+nt._width,this._drawOffsetY,this._nextChunks)},Ii._createTileObjectPools=function(){this._triggerMoveUp=new z,this._triggerMoveDown=new z,this._triggerTunnelUp=new z,this._triggerTunnelDown=new z,this._droneGuardLeft=new z,this._droneGuardRight=new z,this._railStopSign=new z;for(var t=0;t<3;t++){var i=lt.createEntity(0,-nt._centerY,0);i.tag=ie.CameraMoveUp,i.setActive(!1);var e=i.addCollider(16,2*nt._height);e.tagFilter=ie.PlayerProjectile,e.collisionEdgeTop=!1,e.collisionEdgeLeft=!1,e.collisionEdgeRight=!1,e.collisionEdgeBottom=!1,this._triggerMoveUp.addToPool(i)}for(t=0;t<3;t++){var s=lt.createEntity(0,-nt._centerY,0);s.tag=ie.CameraMoveDown,s.setActive(!1);var a=s.addCollider(16,2*nt._height);a.tagFilter=ie.PlayerProjectile,a.collisionEdgeTop=!1,a.collisionEdgeLeft=!1,a.collisionEdgeRight=!1,a.collisionEdgeBottom=!1,this._triggerMoveDown.addToPool(s)}for(t=0;t<4;t++){var o=lt.createEntity(0,-nt._centerY,0);o.tag=ie.TunnelUpTrigger,o.setActive(!1);var r=o.addCollider(16,2*nt._height);r.tagFilter=ie.PlayerProjectile,r.collisionEdgeTop=!1,r.collisionEdgeLeft=!1,r.collisionEdgeRight=!1,r.collisionEdgeBottom=!1,this._triggerTunnelUp.addToPool(o)}for(t=0;t<4;t++){var n=lt.createEntity(0,-nt._centerY,0);n.tag=ie.TunnelDownTrigger,n.setActive(!1);var h=n.addCollider(16,2*nt._height);h.tagFilter=ie.PlayerProjectile,h.collisionEdgeTop=!1,h.collisionEdgeLeft=!1,h.collisionEdgeRight=!1,h.collisionEdgeBottom=!1,this._triggerTunnelDown.addToPool(n)}for(t=0;t<10;t++){(_=lt.createEntity(0,0,$i.Characters)).tag=ie.DroneGuardLeft,_.setActive(!1),(l=_.addCollider(_t._map._tilewidth,_t._map._tileheight)).tagFilter=ie.PlayerProjectile,l.collisionEdgeTop=!1,l.collisionEdgeLeft=!1,l.collisionEdgeRight=!1,l.collisionEdgeBottom=!1,this._droneGuardLeft.addToPool(_)}for(var _,l,t=0;t<10;t++){(_=lt.createEntity(0,0,$i.Characters)).tag=ie.DroneGuardRight,_.setActive(!1),(l=_.addCollider(_t._map._tilewidth,_t._map._tileheight)).tagFilter=ie.PlayerProjectile,l.collisionEdgeTop=!1,l.collisionEdgeLeft=!1,l.collisionEdgeRight=!1,l.collisionEdgeBottom=!1,this._droneGuardRight.addToPool(_)}for(t=0;t<6;t++)this._railStopSign.addToPool((new Xt)._entity)},Ii.fixedUpdate=function(){var t,i,e,s=this._nextJumpX,a=this._nextJumpX*nt._width;ht._x>a&&this._nextJumpX++,s!=this._nextJumpX&&(t=this._lastChunks[$i.PropsBehind],i=this._lastChunks[$i.Platforms],e=this._lastChunks[$i.PropsFront],this._lastChunks[$i.PropsBehind]=this._currentChunks[$i.PropsBehind],this._lastChunks[$i.Platforms]=this._currentChunks[$i.Platforms],this._lastChunks[$i.PropsFront]=this._currentChunks[$i.PropsFront],this._currentChunks[$i.PropsBehind]=this._nextChunks[$i.PropsBehind],this._currentChunks[$i.Platforms]=this._nextChunks[$i.Platforms],this._currentChunks[$i.PropsFront]=this._nextChunks[$i.PropsFront],this._nextChunks[$i.PropsBehind]=t,this._nextChunks[$i.Platforms]=i,this._nextChunks[$i.PropsFront]=e,this.spawnChunkInsidePosition(ht._x+nt._width,this._drawOffsetY,this._nextChunks))},Ii.createEmptyLayers=function(t){this._lastChunks[t]=this.createEmptyChunkEntity(t),this._currentChunks[t]=this.createEmptyChunkEntity(t),this._nextChunks[t]=this.createEmptyChunkEntity(t),this._transitionChunkTop[t]=this.createEmptyChunkEntity(t),this._transitionChunkRight[t]=this.createEmptyChunkEntity(t),this._lastChunks[t].fixedUpdate=new Li,this._currentChunks[t].fixedUpdate=new Li,this._nextChunks[t].fixedUpdate=new Li,this._transitionChunkTop[t].fixedUpdate=new Li(!0),this._transitionChunkRight[t].fixedUpdate=new Li(!0)},Ii.createEmptyChunkEntity=function(t){var i=lt.createEntity(0,0,t);i.tag=ie.MapChunk;for(var e=_t._map,s=0;s<12;s++)for(var a=0;a<20;a++){var o=i.addCollider(e._tilewidth,e._tileheight),r=a*e._tilewidth,n=s*e._tileheight;o.offsetX=8+r,o.offsetY=n;for(var h=_t._texturesById[2],_=i.addSprite(h,r,n),l=0;l<10;l++)_.addAnimationFrame(h,100);_.clearAnimation()}return i.setActive(!1),i},Ii._createChunk=function(t,i,e){var s=e[i],a=s.fixedUpdate,o=_t._map,r=_t._texturesById,n=_t._map._animationsById,h=_t._map._tileTypes,_=t._tileNumbers,l=t._x,d=t._y,c=t._width,p=(t._height,l*o._tilewidth),u=d*o._tileheight;s.setActive(!0),s.x=p,s.y=u,a.clear();for(var g=-1,f=0,y=0;y<_.length;y++){++g==c&&(g=0,f++);var m=_[y],v=s._colliders[y],x=s._sprites[y],T=r[m],S=h[m];if(x.clearAnimation(),x.active=!1,v.reset(),v.active=!1,T){var w=g*o._tilewidth+T._halfWidth,b=f*o._tileheight-T._halfHeight+.5*o._tileheight;if(S)switch(v.slope=0,v.slopeNumber=0,v.tagFilter=-1,S){case"collider":v.active=!0,v.collisionEdgeTop=!0,v.collisionEdgeLeft=!1,v.collisionEdgeRight=!1,v.collisionEdgeBottom=!0;break;case"hiddenCollider":v.active=!0,v.collisionEdgeTop=!0,v.collisionEdgeLeft=!1,v.collisionEdgeRight=!1,v.collisionEdgeBottom=!0;continue;case"slopeUp1":case"slopeUp1Hidden":if(v.slope=1,v.active=!0,v.tagFilter=ie.PlayerProjectile,v.collisionEdgeLeft=!0,v.collisionEdgeRight=!0,v.collisionEdgeTop=!0,v.collisionEdgeBottom=!0,"slopeUp1Hidden"==S)continue;x.active=!0;break;case"slopeDown1":case"slopeDown1Hidden":if(v.slope=-1,v.active=!0,v.tagFilter=ie.PlayerProjectile,v.collisionEdgeLeft=!0,v.collisionEdgeRight=!0,v.collisionEdgeTop=!0,v.collisionEdgeBottom=!0,"slopeDown1Hidden"==S)continue;x.active=!0;break;case"slopeUp2-1":v.slope=2,v.slopeNumber=0,v.active=!0,v.tagFilter=ie.PlayerProjectile,v.collisionEdgeLeft=!0,v.collisionEdgeRight=!0,v.collisionEdgeTop=!0,v.collisionEdgeBottom=!0;break;case"slopeUp2-2":v.slope=2,v.slopeNumber=1,v.active=!0,v.tagFilter=ie.PlayerProjectile,v.collisionEdgeLeft=!0,v.collisionEdgeRight=!0,v.collisionEdgeTop=!0,v.collisionEdgeBottom=!0;break;case"slopeDown2-1":v.slope=-2,v.slopeNumber=1,v.active=!0,v.tagFilter=ie.PlayerProjectile,v.collisionEdgeLeft=!0,v.collisionEdgeRight=!0,v.collisionEdgeTop=!0,v.collisionEdgeBottom=!0;break;case"slopeDown2-2":v.slope=-2,v.slopeNumber=0,v.active=!0,v.tagFilter=ie.PlayerProjectile,v.collisionEdgeLeft=!0,v.collisionEdgeRight=!0,v.collisionEdgeTop=!0,v.collisionEdgeBottom=!0;break;case"slopeUp3-1":v.slope=3,v.slopeNumber=0,v.active=!0,v.tagFilter=ie.PlayerProjectile,v.collisionEdgeLeft=!0,v.collisionEdgeRight=!0,v.collisionEdgeTop=!0,v.collisionEdgeBottom=!0;continue;case"slopeUp3-2":v.slope=3,v.slopeNumber=1,v.active=!0,v.tagFilter=ie.PlayerProjectile,v.collisionEdgeLeft=!0,v.collisionEdgeRight=!0,v.collisionEdgeTop=!0,v.collisionEdgeBottom=!0;continue;case"slopeUp3-3":v.slope=3,v.slopeNumber=2,v.active=!0,v.tagFilter=ie.PlayerProjectile,v.collisionEdgeLeft=!0,v.collisionEdgeRight=!0,v.collisionEdgeTop=!0,v.collisionEdgeBottom=!0;continue;case"slopeDown3-1":v.slope=-3,v.slopeNumber=2,v.active=!0,v.tagFilter=ie.PlayerProjectile,v.collisionEdgeLeft=!0,v.collisionEdgeRight=!0,v.collisionEdgeTop=!0,v.collisionEdgeBottom=!0;continue;case"slopeDown3-2":v.slope=-3,v.slopeNumber=1,v.active=!0,v.tagFilter=ie.PlayerProjectile,v.collisionEdgeLeft=!0,v.collisionEdgeRight=!0,v.collisionEdgeTop=!0,v.collisionEdgeBottom=!0;continue;case"slopeDown3-3":v.slope=-3,v.slopeNumber=0,v.active=!0,v.tagFilter=ie.PlayerProjectile,v.collisionEdgeLeft=!0,v.collisionEdgeRight=!0,v.collisionEdgeTop=!0,v.collisionEdgeBottom=!0;continue;case"chunkMarker":continue;case"tunnelEnter":Ht.fadeOutFogFront=!0;break;case"tunnelExit":Ht.fadeInFogFrontDelay=rt._lastUpdateTime+4200,Ht.fadeInFogFront=!0;break;case"flyingDrone1SpawnLeft":var D=Ui._flyingDrones1Left.getAvailableEntity();D&&D.fixedUpdate.init(s.x+w,s.y+b);continue;case"flyingDrone1SpawnRight":var A=Ui._flyingDrones1Right.getAvailableEntity();A&&A.fixedUpdate.init(s.x+w,s.y+b);continue;case"flyingDrone2":var E=Ui._flyingDrones2.getAvailableEntity();E&&E.fixedUpdate.init(s.x+w,s.y+b);continue;case"flyingDrone3":var F=Ui._flyingDrones3.getAvailableEntity();F&&F.fixedUpdate.init(s.x+w,s.y+b);continue;case"flyingDrone4":var B=Ui._flyingDrones4.getAvailableEntity();B&&B.fixedUpdate.init(s.x+w,s.y+b);continue;case"flyingDrone5":var P=Ui._flyingDrones5.getAvailableEntity();P&&P.fixedUpdate.init(s.x+w,s.y+b);continue;case"groundDrone1":var C=Ui._groundDrones1.getAvailableEntity();C&&C.fixedUpdate.init(s.x+w,s.y+b-20);continue;case"groundDrone2":var k=Ui._groundDrones2.getAvailableEntity();k&&k.fixedUpdate.init(s.x+w,s.y+b);continue;case"cameraUp":this.spawnChunkInsidePosition(ht._x+2*nt._width,this._drawOffsetY,this._transitionChunkRight),this._drawOffsetY=-12,this.spawnChunkInsidePosition(ht._x+nt._width,this._drawOffsetY,this._transitionChunkTop);var U=this._triggerMoveUp.getAvailableEntity();U&&(U.x=s.x+w,U.y=s.y+b-nt._centerY);continue;case"cameraDown":this.spawnChunkInsidePosition(ht._x+2*nt._width,this._drawOffsetY,this._transitionChunkRight),this._drawOffsetY=0,this.spawnChunkInsidePosition(ht._x+nt._width,this._drawOffsetY,this._transitionChunkTop);var R=this._triggerMoveDown.getAvailableEntity();R&&(R.x=s.x+w,R.y=s.y+b);continue;case"tunnelUp":this._drawOffsetY=-12;var X=this._triggerTunnelUp.getAvailableEntity();X&&(X.x=s.x+w,X.y=s.y+b);continue;case"tunnelDown":var Y=this._triggerTunnelDown.getAvailableEntity();Y&&(Y.x=s.x+w,Y.y=s.y+b);continue;case"railStopSign":var L=this._railStopSign.getAvailableEntity();L&&(L.x=s.x+w,L.y=s.y+b);continue;case"stopLeft":var M=this._droneGuardLeft.getAvailableEntity();M&&(M.x=s.x+w,M.y=s.y+b,a.addToExtras(M));continue;case"stopRight":var O=this._droneGuardRight.getAvailableEntity();O&&(O.x=s.x+w,O.y=s.y+b,a.addToExtras(O));continue;case"tunnelTrap1":var I=Ot._tunnelTraps.getAvailableEntity();I&&(I.x=s.x+w,I.y=s.y+b);continue;case"obstacle1":var H=Ot._slimeTraps1.getAvailableEntity();H&&(H.x=s.x+w,H.y=s.y+b);continue;case"groundTurret1":var W=Ot._groundTurrets1.getAvailableEntity();W&&(W.x=s.x+w,W.y=s.y+b);continue;case"explosionTrap1Idle":var j=Ot._explosionTraps1.getAvailableEntity();j&&(j.x=s.x+w,j.y=s.y+b);continue;case"fireTrap1":var z=Ot._fireTraps1.getAvailableEntity();z&&(z.x=s.x+w,z.y=s.y+b);continue;case"poisonTrap1":var G=Ot._poisonTraps1.getAvailableEntity();G&&(G.x=s.x+w,G.y=s.y+b);continue;case"railTurret1":var N=Ot._railTurrets1.getAvailableEntity();N&&(N.x=s.x+w,N.y=s.y+b);continue;case"railCart1":var J=Ot._railCarts1.getAvailableEntity();J&&(J.x=s.x+w,J.y=s.y+b);continue;case"railCart2":var V=Ot._railCarts2.getAvailableEntity();V&&(V.x=s.x+w,V.y=s.y+b);continue;case"slimeDropperDrip":var K=Ot._slimeDropperDrip.getAvailableEntity();K&&(K.x=s.x+w,K.y=s.y+b);continue;case"endTrigger":var q=lt.createEntity(s.x+w,s.y+b-nt._centerY,$i.Platforms);q.tag=ie.End;var Z=q.addCollider(16,2*nt._height);Z.tagFilter=ie.PlayerProjectile,Z.collisionEdgeTop=!1,Z.collisionEdgeLeft=!1,Z.collisionEdgeRight=!1,Z.collisionEdgeBottom=!1;continue;case"pickupHeart":var Q=Gi._hearts.getAvailableEntity();Q&&(Q.x=s.x+w,Q.y=s.y+b);continue;case"pickupCoin1":var $=Gi._coins.getAvailableEntity();$&&($.x=s.x+w,$.y=s.y+b);continue;case"stop":var tt=lt.createEntity(s.x+w,s.y+b,$i.Platforms);tt.tag=ie.Stop;var it=tt.addCollider(16,nt._centerY);it.tagFilter=ie.PlayerProjectile,it.collisionEdgeTop=!1,it.collisionEdgeLeft=!1,it.collisionEdgeRight=!1,it.collisionEdgeBottom=!1;continue;case"endGateIdle":var et=new Lt;et._entity.x=s.x+w,et._entity.y=s.y+b}var st=n[m];if(x.active=!0,x.setTexture(T),x.drawOffsetX=w,x.drawOffsetY=b,st)for(var at=0;at<st.length;at++){var ot=st[at];r[ot._id]&&x.addAnimationFrame(r[ot._id],ot._duration)}}}},Ii.spawnChunkInsidePosition=function(t,i,e){for(var s=_t._map,a=0;a<s._layers.length;a++)for(var o=s._layers[a],r=0;r<o._chunks.length;r++){var n=o._chunks[r],h=n._x*Math.floor(s._tilewidth),_=n._y*Math.floor(s._tileheight),l=(n._x+n._width)*s._tilewidth,d=(n._y+n._height)*s._tileheight;if(h<=t&&t<l&&_<=i&&i<d)switch(o._name){case"Props Behind":this._createChunk(n,$i.PropsBehind,e);break;case"Platforming":this._createChunk(n,$i.Platforms,e);break;case"Props Front":this._createChunk(n,$i.PropsFront,e)}}},Ii);function Ii(){}var Hi=(Wi.prototype.fixedUpdate=function(t){for(var i=t._colliders[0],e=0;e<i._hitCount;e++){if(i._hits[e]._entity.tag==ie.Player){I.playSound("assets/Audio/powerup1.ogg"),dt._lives<dt._maxLives?dt.addToLives():dt.addToScore(50,t.x,t.y),t.setActive(!1);break}}t.x<ht._x-nt._centerX-t._sprites[0]._texture._drawWidth&&t.setActive(!1)},Wi);function Wi(){this._entity=lt.createEntity(0,0,$i.Platforms),(this._entity.fixedUpdate=this)._entity.tag=ie.PickupHeart,_t.addSpriteFromAnimation(this._entity,"pickupHeart");var t=this._entity.addCollider(12,12);t.tagFilter=ie.PlayerProjectile,t.offsetX=-1,t.offsetY=1,t.collisionEdgeTop=!1,t.collisionEdgeLeft=!1,t.collisionEdgeRight=!1,t.collisionEdgeBottom=!1}var ji=(zi.prototype.fixedUpdate=function(t){for(var i=t._colliders[0],e=0;e<i._hitCount;e++){if(i._hits[e]._entity.tag==ie.Player){I.playSound("assets/Audio/coin1.ogg"),dt.addToScore(5,this._entity.x,this._entity.y),t.setActive(!1);break}}t.x<ht._x-nt._centerX-t._sprites[0]._texture._drawWidth&&t.setActive(!1)},zi);function zi(){this._entity=lt.createEntity(0,0,$i.Platforms),(this._entity.fixedUpdate=this)._entity.tag=ie.PickupCoin,_t.addSpriteFromAnimation(this._entity,"pickupCoin1");var t=this._entity.addCollider(12,12);t.offsetX=-1,t.offsetY=1,t.tagFilter=ie.PlayerProjectile,t.collisionEdgeTop=!1,t.collisionEdgeLeft=!1,t.collisionEdgeRight=!1,t.collisionEdgeBottom=!1}var Gi=(Ni.init=function(){this._hearts=new z,this._coins=new z;for(var t=0;t<6;t++)this._hearts.addToPool((new Hi)._entity);for(t=0;t<100;t++)this._coins.addToPool((new ji)._entity)},Ni.fixedUpdate=function(){},Ni);function Ni(){}var Ji=(Vi.init=function(){this._playerPushedButton=!1;var t=lt.createEntity(0,0,$i.UIBehind);t.tag=ie.HitTester,t.setActive(!1);var i=t.addCollider(2,2);i.collisionEdgeTop=!1,i.collisionEdgeLeft=!1,i.collisionEdgeRight=!1,i.collisionEdgeBottom=!1,i.type=k.Dynamic,t.ui=!0,this._hitTester=t},Vi.fixedUpdate=function(){!se.showMobileControlsOnLoad&&L._touchDown&&(se.showMobileControlsOnLoad=!0),!L._mouseButtonDown[0]&&!L._touchDown||this._hitTester._active||this._playerPushedButton?this._hitTester._active?this._hitTester.setActive(!1):L._mouseButtonDown[0]||L._touchDown||!this._playerPushedButton||(this._playerPushedButton=!1):(this._hitTester.setActive(!0),this._hitTester.x=L._mousePositionX/nt._scale,this._hitTester.y=L._mousePositionY/nt._scale,this._playerPushedButton=!0)},Vi);function Vi(){}var Ki=(qi.init=function(){new Gt,new jt},qi.fixedUpdate=function(){},qi);function qi(){}var Zi,Qi,$i,te,ie,ee,se=(ae.init=function(){this._touchControlsHidden=!0,this.showMobileControlsOnLoad=!1,this._upButtonDown=!1,this._downButtonDown=!1,this._leftButtonDown=!1,this._rightButtonDown=!1,this._action1ButtonDown=!1,this._action2ButtonDown=!1,this._stick1Down=!1,this._stick2Down=!1,this._startDown=!1,this._upButtonPressed=!1,this._downButtonPressed=!1,this._leftButtonPressed=!1,this._rightButtonPressed=!1,this._action1ButtonPressed=!1,this._action2ButtonPressed=!1,this._stick1Pressed=!1,this._stick2Pressed=!1,this._startPressed=!1},ae.fixedUpdate=function(){this._upButtonPressed=!1,this._downButtonPressed=!1,this._leftButtonPressed=!1,this._rightButtonPressed=!1,this._action1ButtonPressed=!1,this._action2ButtonPressed=!1;var t=this._startPressed=!1,i=!1,e=!1,s=!1,a=!1,o=!1,r=!1,n=!1;if(0<L._gamepadsCount)for(var h in L._gamepads){var _,l=L._gamepads[h],d=l.axis[0],c=l.axis[1],p=l.axis[2],u=l.axis[3];d&&(.5<d?s=!0:d<-.5&&(e=!0)),c&&(.3<c?i=!0:c<-.5&&(t=!0)),p&&u&&(_=Math.atan2(u,p)/Math.PI,.8<Math.sqrt(p*p+u*u)&&(_<-.4?dt.switchGunDirection(et.Up):_<-.2?dt.switchGunDirection(et.UpRight):dt.switchGunDirection(et.Right))),(l.buttons[0]||l.buttons[12])&&(t=!0),l.buttons[13]&&(i=!0),l.buttons[14]&&(e=!0),l.buttons[15]&&(s=!0),(l.buttons[3]||l.buttons[2])&&(a=!0),(l.buttons[1]||l.buttons[2])&&(o=!0),l.buttons[9]&&(r=!0),l.buttons[7]&&(n=!0)}L._keyDown.KeyW||L._keyDown.ArrowUp||t?this._upButtonDown||(this._upButtonPressed=!0,this._upButtonDown=!0):this._upButtonDown&&(this._upButtonDown=!1),L._keyDown.KeyS||L._keyDown.ArrowDown||i?this._downButtonDown||(this._downButtonPressed=!0,this._downButtonDown=!0):this._downButtonDown&&(this._downButtonDown=!1),L._keyDown.KeyA||L._keyDown.ArrowLeft||e?this._leftButtonDown||(this._leftButtonPressed=!0,this._leftButtonDown=!0):this._leftButtonDown&&(this._leftButtonDown=!1),L._keyDown.KeyD||L._keyDown.ArrowRight||s?this._rightButtonDown||(this._rightButtonPressed=!0,this._rightButtonDown=!0):this._rightButtonDown&&(this._rightButtonDown=!1),L._keyDown.KeyN||a?this._action1ButtonDown||(this._action1ButtonPressed=!0,this._action1ButtonDown=!0):this._action1ButtonDown&&(this._action1ButtonDown=!1),L._keyDown.KeyM||o?this._action2ButtonDown||(this._action2ButtonPressed=!0,this._action2ButtonDown=!0):this._action2ButtonDown&&(this._action2ButtonDown=!1),L._keyDown.Space||L._keyDown.Enter||r?this._startDown||(this._startPressed=!0,this._startDown=!0):this._startDown&&(this._startDown=!1),n?this._triggerButton1Down||(this._triggerButton1Down=!0):this._triggerButton1Down&&(this._triggerButton1Down=!1)},ae);function ae(){}(Qi=Zi=Zi||{})[Qi.ClickToPlay=0]="ClickToPlay",Qi[Qi.Intro=1]="Intro",Qi[Qi.Main=2]="Main",(te=$i=$i||{})[te.Sky=0]="Sky",te[te.ParallaxFar=1]="ParallaxFar",te[te.ParallaxNear=2]="ParallaxNear",te[te.Background=3]="Background",te[te.PropsBehind=4]="PropsBehind",te[te.PropsBehindFade=5]="PropsBehindFade",te[te.Platforms=6]="Platforms",te[te.UIBehind=7]="UIBehind",te[te.Characters=8]="Characters",te[te.PropsFront=9]="PropsFront",te[te.Foreground=10]="Foreground",te[te.UIFront=11]="UIFront",(ee=ie=ie||{})[ee.Player=0]="Player",ee[ee.StartTrigger=1]="StartTrigger",ee[ee.PickupHeart=2]="PickupHeart",ee[ee.PickupCoin=3]="PickupCoin",ee[ee.PlayerProjectile=4]="PlayerProjectile",ee[ee.Drone1Projectile=5]="Drone1Projectile",ee[ee.Drone2Projectile=6]="Drone2Projectile",ee[ee.Drone4Projectile=7]="Drone4Projectile",ee[ee.FlyingDrone1=8]="FlyingDrone1",ee[ee.FlyingDrone2=9]="FlyingDrone2",ee[ee.FlyingDrone3=10]="FlyingDrone3",ee[ee.FlyingDrone4=11]="FlyingDrone4",ee[ee.FlyingDrone5=12]="FlyingDrone5",ee[ee.TunnelTrap1=13]="TunnelTrap1",ee[ee.TurretProjectile=14]="TurretProjectile",ee[ee.SlimeDrip=15]="SlimeDrip",ee[ee.GroundDrone1=16]="GroundDrone1",ee[ee.GroundDrone2=17]="GroundDrone2",ee[ee.DroneGuardLeft=18]="DroneGuardLeft",ee[ee.DroneGuardRight=19]="DroneGuardRight",ee[ee.GroundTurret1=20]="GroundTurret1",ee[ee.HitTester=21]="HitTester",ee[ee.RailTurret1=22]="RailTurret1",ee[ee.RailCart1=23]="RailCart1",ee[ee.RailCart2=24]="RailCart2",ee[ee.FireTrap1=25]="FireTrap1",ee[ee.PoisonTrap1=26]="PoisonTrap1",ee[ee.ExplosionTrap1=27]="ExplosionTrap1",ee[ee.AudioToggle=28]="AudioToggle",ee[ee.CameraMoveUp=29]="CameraMoveUp",ee[ee.CameraMoveDown=30]="CameraMoveDown",ee[ee.TunnelUpTrigger=31]="TunnelUpTrigger",ee[ee.TunnelDownTrigger=32]="TunnelDownTrigger",ee[ee.SlimeTrap1=33]="SlimeTrap1",ee[ee.MapChunk=34]="MapChunk",ee[ee.RailStopSign=35]="RailStopSign",ee[ee.ScreenShotButton=36]="ScreenShotButton",ee[ee.End=37]="End",ee[ee.Stop=38]="Stop",ee[ee.EndGate=39]="EndGate";var oe=(re.prototype.fixedUpdate=function(t){if(se._startDown)this._startGameWithSound();else for(var i=0;this._collider._hitCount;i++){if(this._collider._hits[i]._entity.tag==ie.HitTester){this._startGameWithSound();break}}},re.prototype._startGameWithSound=function(){lt.shutDown(),_e.init(_e._skipIntro?Zi.Main:Zi.Intro)},re);function re(){this._clickToPlayBg=lt.createEntity(nt._centerX,nt._centerY,$i.UIBehind),this._clickToPlayBg.ui=!0;var t=new m("assets/interface/ClickToPlay.png");this._clickToPlayBg.addSprite(t),(this._clickToPlayBg.fixedUpdate=this)._collider=this._clickToPlayBg.addCollider(nt._width,nt._height),this._clickToPlayText=lt.createEntity(nt._centerX,nt._centerY+2,$i.UIBehind),this._clickToPlayText.ui=!0,this._clickToPlayText.colorTintR=0,this._clickToPlayText.colorTintG=0,this._clickToPlayText.colorTintB=0,this._clickToPlayText.setText("CLICK TO PLAY!")}var ne=(he.prototype.fixedUpdate=function(t){if(this._canSkipIntro){se._startDown&&this._startMainScene();for(var i=0;i<this._skipCollider._hitCount;i++){this._skipCollider._hits[i]._entity.tag==ie.HitTester&&this._startMainScene()}}},he.prototype._startMainScene=function(){for(var t=0;t<this._timeOuts.length;t++)clearTimeout(this._timeOuts[t]);lt.shutDown(),_e.init(Zi.Main)},he);function he(){var t=this;this._canSkipIntro=!1,this._timeOuts=[],this._entity=lt.createEntity(0,0,0),(this._entity.fixedUpdate=this)._skipEntity=lt.createEntity(nt._centerX,nt._centerY,$i.UIFront),this._skipEntity.ui=!0,this._skipCollider=this._skipEntity.addCollider(300,120),this._tonyAnimationSin=[-10,-2,2,10,5,2,-2,-10];var i=new m("assets/intro/panel-top.png"),e=new m("assets/intro/panel-bottom.png"),s=new m("assets/intro/panel-left1.png"),a=new m("assets/intro/panel-left2.png"),o=new m("assets/intro/panel-right1.png"),r=new m("assets/intro/panel-right2.png"),n=new m("assets/intro/pannel-mid1.png"),h=new m("assets/intro/pannel-mid2.png");this._panelTopSprite=this._entity.addSprite(i),this._panelTopSprite.active=!1,this._panelBotSprite=this._entity.addSprite(e),this._panelBotSprite.active=!1,this._panelLeft1Sprite=this._entity.addSprite(s,-139),this._panelLeft1Sprite.active=!1,this._panelLeft2Sprite=this._entity.addSprite(a,-108),this._panelLeft2Sprite.active=!1,this._panelRight1Sprite=this._entity.addSprite(o,140),this._panelRight1Sprite.active=!1,this._panelRight2Sprite=this._entity.addSprite(r,105),this._panelRight2Sprite.active=!1,this._panelMid1Sprite=this._entity.addSprite(n),this._panelMid1Sprite.active=!1,this._panelMid2Sprite=this._entity.addSprite(h),this._panelMid2Sprite.active=!1,this._timeOuts.push(setTimeout(function(){t._panelTopSprite.active=!0,t._panelTopSprite.drawOffsetY=-135,t._panelBotSprite.active=!0,t._panelBotSprite.drawOffsetY=108},400)),this._timeOuts.push(setTimeout(function(){t._panelLeft1Sprite.active=!0,t._panelRight1Sprite.active=!0,t._panelTopSprite.drawOffsetY=-85,t._panelBotSprite.drawOffsetY=79,I.playSound("assets/Audio/introHit.ogg")},500)),this._timeOuts.push(setTimeout(function(){t._panelLeft1Sprite.active=!1,t._panelRight1Sprite.active=!1,t._panelLeft2Sprite.active=!0,t._panelRight2Sprite.active=!0,t._panelTopSprite.drawOffsetY=-29,t._panelBotSprite.drawOffsetY=71,t._vivaldiLogo.active=!0,t._vivaldiLogo.playAnimation(),t._canSkipIntro=!0},600)),this._timeOuts.push(setTimeout(function(){t._panelTopSprite.active=!1,t._panelBotSprite.active=!1,t._panelLeft2Sprite.active=!1,t._panelRight2Sprite.active=!1,t._panelMid1Sprite.active=!0},700)),this._timeOuts.push(setTimeout(function(){t._panelMid1Sprite.active=!1,t._panelMid2Sprite.active=!0},800)),this._timeOuts.push(setTimeout(function(){I.playSound("assets/Audio/glitch1.ogg")},1700)),this._vivaldiLogo=_t.addSpriteFromAnimation(this._entity,"vivaldiLogoAnimation"),this._vivaldiLogo.repeatAnimation(!1),this._vivaldiLogo.drawOffsetY=-27,this._vivaldiLogo.active=!1,this._vivaldiLogo.animationFinishedCallback=function(){t._vivaldiLogo.active=!1,t._tonyAnimation.active=!0,t._tonyAnimation.playAnimation(),t._timeOuts.push(setTimeout(function(){I.playSound("assets/Audio/tonyYay.ogg")},1200))};var _=-1,l=_t._texturesByType.tonyFrontIdle[0];this._tonyAnimation=this._entity.addSprite(l),this._tonyAnimation.addAnimationFrame(l,100),this._tonyAnimation.addAnimationFrame(l,100,0,this._tonyAnimationSin[++_]),this._tonyAnimation.addAnimationFrame(l,100,0,this._tonyAnimationSin[++_]),this._tonyAnimation.addAnimationFrame(l,100,0,this._tonyAnimationSin[++_]),this._tonyAnimation.addAnimationFrame(l,100,0,this._tonyAnimationSin[++_]),this._tonyAnimation.addAnimationFrame(l,100,0,this._tonyAnimationSin[++_]),this._tonyAnimation.addAnimationFrame(l,100,0,this._tonyAnimationSin[++_]);for(var d=_t._map._animationsByType.tonyBallin,c=0;c<d.length;c++){++_%this._tonyAnimationSin.length==0&&(_=0);var p=this._tonyAnimationSin[_],u=d[c];this._tonyAnimation.addAnimationFrame(_t._texturesById[u._id],u._duration,0,p)}this._tonyAnimation.repeatAnimation(!1),this._tonyAnimation.drawOffsetY=-12,this._tonyAnimation.active=!1,this._tonyAnimation.animationFinishedCallback=function(){t._tonyAnimation.active=!1,t._timeOuts.push(setTimeout(function(){t._tonyAnimation.active=!1,t._pfLogo.active=!0,t._pfLogo.playAnimation(),I.playSound("assets/Audio/whoosh.ogg")},200)),t._timeOuts.push(setTimeout(function(){I.playSound("assets/Audio/glitch2.ogg")},1500))},this._pfLogo=_t.addSpriteFromAnimation(this._entity,"pfLogoAnimation"),this._pfLogo.drawOffsetY=-27,this._pfLogo.repeatAnimation(!1),this._pfLogo.active=!1,this._pfLogo.animationFinishedCallback=function(){t._pfLogo.active=!1,I.playSound("assets/Audio/glitch3.ogg"),t._timeOuts.push(setTimeout(function(){t._pfLogo.active=!1,t._vivaldiText.active=!0,t._vivaldiText.playAnimation()},200)),t._timeOuts.push(setTimeout(function(){I.playSound("assets/Audio/glimmer.ogg")},400))},this._vivaldiText=_t.addSpriteFromAnimation(this._entity,"vivaldiTextAnimation"),this._vivaldiText.drawOffsetY=-27,this._vivaldiText.active=!1,this._vivaldiText.repeatAnimation(!1),this._vivaldiText.animationFinishedCallback=function(){t._timeOuts.push(setTimeout(function(){t._vivaldiText.active=!1,t._panelMid2Sprite.active=!1},600)),t._timeOuts.push(setTimeout(function(){t._startMainScene()},800))}}var _e=(le.preload=function(){var t=this,i=new at(this._start.bind(this),this._fixedUpdate.bind(this));i.messageCallback=this._messageCallback.bind(this),this._spectator=0<lt._locationHref.indexOf("spectator=true"),this._skipIntro=0<lt._locationHref.indexOf("skip_intro=true"),lt.preload(i,function(){lt._canPlaySoundAtStartup?t.init(t._skipIntro?Zi.Main:Zi.Intro):t.init(Zi.ClickToPlay)})},le._messageCallback=function(t){t.data[0]===e.VivaldiNameSpaceFound&&Kt.enableScreenshotButtonOnGameOver()},le.init=function(t){le._highScoreKey="high_score_"+_t._map._filename,le._currentScene=t,lt.init(new D("assets/interface/font.png",7,20)),postMessage([e.VivaldiaWorkerInitialized])},le._start=function(){switch(Ji.init(),this._currentScene){case Zi.ClickToPlay:new oe;break;case Zi.Intro:Ki.init(),new ne;break;case Zi.Main:Ki.init(),se.init(),Xi.init(),dt.init(),Zt.init(),_i.init(),Ot.init(),Ht.init(),Ui.init(),Gi.init(),Oi.init()}},le._fixedUpdate=function(){switch(Ji.fixedUpdate(),se.fixedUpdate(),this._currentScene){case Zi.ClickToPlay:break;case Zi.Intro:Ki.fixedUpdate();break;case Zi.Main:Ki.fixedUpdate(),Xi.fixedUpdate(),dt.fixedUpdate(),Zt.fixedUpdate(),_i.fixedUpdate(),Ot.fixedUpdate(),Ht.fixedUpdate(),Ui.fixedUpdate(),Gi.fixedUpdate(),Oi.fixedUpdate()}},le);function le(){}lt.entryPoint=_e.preload.bind(_e)}();
